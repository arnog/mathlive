<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="utf-8"><title>editor/editor-virtualKeyboard.js - MathLive Docs</title><meta name="description" content="Beautifully typeset math made easy"><meta name="keywords" content="latex, tex, math, typesetting, documentation, docs">

    <meta name="viewport" content="width=device-width, initial-scale=1">


    
        <link rel="stylesheet" href="http://mathlive.io/deploy/mathlive/mathlive.core.css" type="text/css"><link rel="stylesheet" href="http://mathlive.io/deploy/mathlive/mathlive.css" type="text/css">
    


    <script src="scripts/prettify/prettify.js"></script>
    <script src="scripts/prettify/lang-css.js"></script>
    <!--[if lt IE 9]>
      <script src="//html5shiv.googlecode.com/svn/trunk/html5.js"></script>
    <![endif]-->
    <link href="https://fonts.googleapis.com/css?family=Source+Code+Pro:400,700|Source+Sans+Pro:400,400i,700,900" rel="stylesheet">
    <style>pre.prettyprint{background: #35434e;}</style>
    <link type="text/css" rel="stylesheet" href="styles/prettify-tomorrow-night.css">

    <link type="text/css" rel="stylesheet" href="styles/jsdoc-default.css">
    <link type="text/css" rel="stylesheet" href="styles/custom.css">
</head>
<body>


<div class="forkme"><a href="https://github.com/arnog/mathlive"><img style="position: absolute; top: 0; right: 0; border: 0; z-index:1;" src="https://camo.githubusercontent.com/52760788cde945287fbb584134c4cbc2bc36f904/68747470733a2f2f73332e616d617a6f6e6177732e636f6d2f6769746875622f726962626f6e732f666f726b6d655f72696768745f77686974655f6666666666662e706e67" alt="Fork me on GitHub" data-canonical-src="https://s3.amazonaws.com/github/ribbons/forkme_right_white_ffffff.png"></a></div>


<section role="navigation">
    <input type="checkbox" id="nav-trigger" class="nav-trigger" />
    <label for="nav-trigger" class="navicon-button x">
        <div class="navicon"></div>
    </label>

    <label for="nav-trigger" class="overlay"></label>

    <nav id="nav">
        <h3 class="group-title home"><a href="index.html">MathLive Docs</a></h3><input class="search" placeholder="Search" type="text"><div class="list"><h3 class="group-title">Tutorials</h3><ul><li><a href="tutorial-CONTRIBUTOR_GUIDE.html">Contributor Guide</a><ul></ul></li><li><a href="tutorial-MASTON.html">MASTON</a><ul></ul></li><li><a href="tutorial-USAGE_GUIDE.html">Usage Guide</a><ul><li><a href="tutorial-EXAMPLES.html">Examples</a></li><li><a href="tutorial-CONFIG.html">Configuration options</a></li><li><a href="tutorial-SELECTORS.html">Selectors for perform()</a></li><li><a href="tutorial-COMMANDS_REFERENCE.html">Commands Reference</a></li></ul></li></ul><h3 class="group-title">Modules</h3><ul><li class="private"><a href="module-color.html" class="className">color</a><ul class='methods private'><li data-type='method' class='private'><a href="module-color.html#.stringToColor" class="methodName">stringToColor</a></li></ul></li><li class="private"><a href="module-definitions.html" class="className">definitions</a><ul class='methods private'><li data-type='method' class='private'><a href="module-definitions.html#.defineEnvironment" class="methodName">defineEnvironment</a></li><li data-type='method' class='private'><a href="module-definitions.html#.defineFunction" class="methodName">defineFunction</a></li><li data-type='method' class='private'><a href="module-definitions.html#.defineSymbol" class="methodName">defineSymbol</a></li><li data-type='method' class='private'><a href="module-definitions.html#.defineSymbolRange" class="methodName">defineSymbolRange</a></li><li data-type='method' class='private'><a href="module-definitions.html#.defineSymbols" class="methodName">defineSymbols</a></li><li data-type='method' class='private'><a href="module-definitions.html#.frequency" class="methodName">frequency</a></li><li data-type='method' class='private'><a href="module-definitions.html#.getInfo" class="methodName">getInfo</a></li><li data-type='method' class='private'><a href="module-definitions.html#.matchCodepoint" class="methodName">matchCodepoint</a></li><li data-type='method' class='private'><a href="module-definitions.html#.matchFunction" class="methodName">matchFunction</a></li><li data-type='method' class='private'><a href="module-definitions.html#.parseParamTemplateArgument" class="methodName">parseParamTemplateArgument</a></li><li data-type='method' class='private'><a href="module-definitions.html#.suggest" class="methodName">suggest</a></li><li data-type='method' class='private'><a href="module-definitions.html#~getSimpleString" class="methodName">getSimpleString</a></li><li data-type='method' class='private'><a href="module-definitions.html#~mathVariantToUnicode" class="methodName">mathVariantToUnicode</a></li></ul></li><li class="private"><a href="module-delimiters.html" class="className">delimiters</a><ul class='methods private'><li data-type='method' class='private'><a href="module-delimiters.html#.makeCustomSizedDelim" class="methodName">makeCustomSizedDelim</a></li><li data-type='method' class='private'><a href="module-delimiters.html#.makeInner" class="methodName">makeInner</a></li><li data-type='method' class='private'><a href="module-delimiters.html#.makeLargeDelim" class="methodName">makeLargeDelim</a></li><li data-type='method' class='private'><a href="module-delimiters.html#.makeLeftRightDelim" class="methodName">makeLeftRightDelim</a></li><li data-type='method' class='private'><a href="module-delimiters.html#.makeNullFence" class="methodName">makeNullFence</a></li><li data-type='method' class='private'><a href="module-delimiters.html#.makeSizedDelim" class="methodName">makeSizedDelim</a></li><li data-type='method' class='private'><a href="module-delimiters.html#.makeSmallDelim" class="methodName">makeSmallDelim</a></li><li data-type='method' class='private'><a href="module-delimiters.html#.makeStackedDelim" class="methodName">makeStackedDelim</a></li><li data-type='method' class='private'><a href="module-delimiters.html#.traverseSequence" class="methodName">traverseSequence</a></li><li data-type='method' class='private'><a href="module-delimiters.html#~delimTypeToFont" class="methodName">delimTypeToFont</a></li></ul></li><li class="private"><a href="module-editor_editableMathlist.html" class="className">editor/editableMathlist</a><ul class='methods private'><li data-type='method' class='private'><a href="module-editor_editableMathlist.html#~arrayCell" class="methodName">arrayCell</a></li><li data-type='method' class='private'><a href="module-editor_editableMathlist.html#~arrayCellCount" class="methodName">arrayCellCount</a></li><li data-type='method' class='private'><a href="module-editor_editableMathlist.html#~arrayColRow" class="methodName">arrayColRow</a></li><li data-type='method' class='private'><a href="module-editor_editableMathlist.html#~arrayIndex" class="methodName">arrayIndex</a></li><li data-type='method' class='private'><a href="module-editor_editableMathlist.html#~atomContains" class="methodName">atomContains</a></li><li data-type='method' class='private'><a href="module-editor_editableMathlist.html#~getString" class="methodName">getString</a></li></ul></li><li class="private"><a href="module-editor_keyboard.html" class="className">editor/keyboard</a><ul class='methods private'><li data-type='method' class='private'><a href="module-editor_keyboard.html#.delegateKeyboardEvents" class="methodName">delegateKeyboardEvents</a></li><li data-type='method' class='private'><a href="module-editor_keyboard.html#.keyboardEventToString" class="methodName">keyboardEventToString</a></li></ul></li><li class="private"><a href="module-editor_mathfield.html" class="className">editor/mathfield</a><ul class='methods private'><li data-type='method' class='private'><a href="module-editor_mathfield.html#nearestElementFromPoint" class="methodName">nearestElementFromPoint</a></li><li data-type='method' class='private'><a href="module-editor_mathfield.html#~_findElementWithCaret" class="methodName">_findElementWithCaret</a></li><li data-type='method' class='private'><a href="module-editor_mathfield.html#~_onAnnounce" class="methodName">_onAnnounce</a></li></ul></li><li class="private"><a href="module-editor_mathpath.html" class="className">editor/mathpath</a><ul class='methods private'><li data-type='method' class='private'><a href="module-editor_mathpath.html#.pathCommonAncestor" class="methodName">pathCommonAncestor</a></li><li data-type='method' class='private'><a href="module-editor_mathpath.html#.pathDistance" class="methodName">pathDistance</a></li><li data-type='method' class='private'><a href="module-editor_mathpath.html#.pathFromString" class="methodName">pathFromString</a></li><li data-type='method' class='private'><a href="module-editor_mathpath.html#.pathToString" class="methodName">pathToString</a></li></ul></li><li class="private"><a href="module-editor_shortcuts.html" class="className">editor/shortcuts</a><ul class='methods private'><li data-type='method' class='private'><a href="module-editor_shortcuts.html#.match" class="methodName">match</a></li><li data-type='method' class='private'><a href="module-editor_shortcuts.html#.matchKeystroke" class="methodName">matchKeystroke</a></li><li data-type='method' class='private'><a href="module-editor_shortcuts.html#.platform" class="methodName">platform</a></li><li data-type='method' class='private'><a href="module-editor_shortcuts.html#.stringify" class="methodName">stringify</a></li></ul></li><li class="private"><a href="module-fontMetrics.html" class="className">fontMetrics</a><ul class='methods private'><li data-type='method' class='private'><a href="module-fontMetrics.html#.getCharacterMetrics" class="methodName">getCharacterMetrics</a></li><li data-type='method' class='private'><a href="module-fontMetrics.html#~convertDimenToEm" class="methodName">convertDimenToEm</a></li></ul></li><li class="private"><a href="module-lexer.html" class="className">lexer</a><ul class='methods private'><li data-type='method' class='private'><a href="module-lexer.html#.tokenize" class="methodName">tokenize</a></li></ul></li><li class="private"><a href="module-mathAtom.html" class="className">mathAtom</a><ul class='methods private'><li data-type='method' class='private'><a href="module-mathAtom.html#.decompose" class="methodName">decompose</a></li><li data-type='method' class='private'><a href="module-mathAtom.html#.getFontName" class="methodName">getFontName</a></li><li data-type='method' class='private'><a href="module-mathAtom.html#.makeColGap" class="methodName">makeColGap</a></li><li data-type='method' class='private'><a href="module-mathAtom.html#.makeColOfRepeatingElements" class="methodName">makeColOfRepeatingElements</a></li><li data-type='method' class='private'><a href="module-mathAtom.html#.makeStack" class="methodName">makeStack</a></li></ul></li><li><a href="module-mathlive.html" class="className">mathlive</a><ul class='methods'><li data-type='method'><a href="module-mathlive.html#latexToAST" class="methodName">latexToAST</a></li><li data-type='method'><a href="module-mathlive.html#latexToMarkup" class="methodName">latexToMarkup</a></li><li data-type='method'><a href="module-mathlive.html#latexToMathML" class="methodName">latexToMathML</a></li><li data-type='method'><a href="module-mathlive.html#makeMathField" class="methodName">makeMathField</a></li><li data-type='method'><a href="module-mathlive.html#pauseReadAloud" class="methodName">pauseReadAloud</a></li><li data-type='method'><a href="module-mathlive.html#playReadAloud" class="methodName">playReadAloud</a></li><li data-type='method'><a href="module-mathlive.html#readAloud" class="methodName">readAloud</a></li><li data-type='method'><a href="module-mathlive.html#readAloudStatus" class="methodName">readAloudStatus</a></li><li data-type='method'><a href="module-mathlive.html#renderMathInDocument" class="methodName">renderMathInDocument</a></li><li data-type='method'><a href="module-mathlive.html#renderMathInElement" class="methodName">renderMathInElement</a></li><li data-type='method'><a href="module-mathlive.html#resumeReadAloud" class="methodName">resumeReadAloud</a></li><li data-type='method'><a href="module-mathlive.html#revertToOriginalContent" class="methodName">revertToOriginalContent</a></li><li data-type='method'><a href="module-mathlive.html#revertToOriginalContent" class="methodName">revertToOriginalContent</a></li><li data-type='method'><a href="module-mathlive.html#~highlightAtomID" class="methodName">highlightAtomID</a></li></ul></li><li class="private"><a href="module-mathstyle.html" class="className">mathstyle</a><ul class='methods private'><li data-type='method' class='private'><a href="module-mathstyle.html#.toMathstyle" class="methodName">toMathstyle</a></li></ul></li><li class="private"><a href="module-span.html" class="className">span</a><ul class='methods private'><li data-type='method' class='private'><a href="module-span.html#.coalesce" class="methodName">coalesce</a></li><li data-type='method' class='private'><a href="module-span.html#.makeFontSizer" class="methodName">makeFontSizer</a></li><li data-type='method' class='private'><a href="module-span.html#.makeHlist" class="methodName">makeHlist</a></li><li data-type='method' class='private'><a href="module-span.html#.makeSpan" class="methodName">makeSpan</a></li><li data-type='method' class='private'><a href="module-span.html#.makeSpanOfType" class="methodName">makeSpanOfType</a></li><li data-type='method' class='private'><a href="module-span.html#.makeSymbol" class="methodName">makeSymbol</a></li><li data-type='method' class='private'><a href="module-span.html#.makeVlist" class="methodName">makeVlist</a></li><li data-type='method' class='private'><a href="module-span.html#.toString" class="methodName">toString</a></li><li data-type='method' class='private'><a href="module-span.html#~makeSVG" class="methodName">makeSVG</a></li></ul></li></ul><h3 class="group-title">Classes</h3><ul><li class="private"><a href="Context.html" class="className">Context</a><ul class='methods private'><li data-type='method' class='private'><a href="Context.html#clone" class="methodName">clone</a></li><li data-type='method' class='private'><a href="Context.html#cloneWith" class="methodName">cloneWith</a></li><li data-type='method' class='private'><a href="Context.html#getBackgroundColor" class="methodName">getBackgroundColor</a></li><li data-type='method' class='private'><a href="Context.html#getColor" class="methodName">getColor</a></li><li data-type='method' class='private'><a href="Context.html#setMathstyle" class="methodName">setMathstyle</a></li><li data-type='method' class='private'><a href="Context.html#withMathstyle" class="methodName">withMathstyle</a></li></ul></li><li><a href="EditableMathlist.html" class="className">EditableMathlist</a><ul class='methods'><li data-type='method'><a href="EditableMathlist.html#_addCell" class="methodName">_addCell</a></li><li data-type='method'><a href="EditableMathlist.html#_deleteAtoms" class="methodName">_deleteAtoms</a></li><li data-type='method'><a href="EditableMathlist.html#addColumnAfter_" class="methodName">addColumnAfter_</a></li><li data-type='method'><a href="EditableMathlist.html#addColumnBefore_" class="methodName">addColumnBefore_</a></li><li data-type='method'><a href="EditableMathlist.html#addRowAfter_" class="methodName">addRowAfter_</a></li><li data-type='method'><a href="EditableMathlist.html#addRowBefore_" class="methodName">addRowBefore_</a></li><li data-type='method' class='private'><a href="EditableMathlist.html#ancestor" class="methodName">ancestor</a></li><li data-type='method' class='private'><a href="EditableMathlist.html#anchor" class="methodName">anchor</a></li><li data-type='method'><a href="EditableMathlist.html#applyStyle" class="methodName">applyStyle</a></li><li data-type='method' class='private'><a href="EditableMathlist.html#commandOffsets" class="methodName">commandOffsets</a></li><li data-type='method' class='private'><a href="EditableMathlist.html#commitCommandStringBeforeInsertionPoint" class="methodName">commitCommandStringBeforeInsertionPoint</a></li><li data-type='method' class='private'><a href="EditableMathlist.html#contains" class="methodName">contains</a></li><li data-type='method' class='private'><a href="EditableMathlist.html#decorateCommandStringAroundInsertionPoint" class="methodName">decorateCommandStringAroundInsertionPoint</a></li><li data-type='method'><a href="EditableMathlist.html#delete" class="methodName">delete</a></li><li data-type='method'><a href="EditableMathlist.html#delete_" class="methodName">delete_</a></li><li data-type='method'><a href="EditableMathlist.html#deleteAll_" class="methodName">deleteAll_</a></li><li data-type='method'><a href="EditableMathlist.html#deleteNextChar_" class="methodName">deleteNextChar_</a></li><li data-type='method'><a href="EditableMathlist.html#deleteNextWord_" class="methodName">deleteNextWord_</a></li><li data-type='method'><a href="EditableMathlist.html#deletePreviousChar_" class="methodName">deletePreviousChar_</a></li><li data-type='method'><a href="EditableMathlist.html#deletePreviousWord_" class="methodName">deletePreviousWord_</a></li><li data-type='method'><a href="EditableMathlist.html#deleteToGroupEnd_" class="methodName">deleteToGroupEnd_</a></li><li data-type='method'><a href="EditableMathlist.html#deleteToGroupStart_" class="methodName">deleteToGroupStart_</a></li><li data-type='method'><a href="EditableMathlist.html#deleteToMathFieldEnd_" class="methodName">deleteToMathFieldEnd_</a></li><li data-type='method' class='private'><a href="EditableMathlist.html#endOffset" class="methodName">endOffset</a></li><li data-type='method' class='private'><a href="EditableMathlist.html#extend" class="methodName">extend</a></li><li data-type='method'><a href="EditableMathlist.html#extendDown_" class="methodName">extendDown_</a></li><li data-type='method'><a href="EditableMathlist.html#extendToGroupEnd_" class="methodName">extendToGroupEnd_</a></li><li data-type='method'><a href="EditableMathlist.html#extendToGroupStart_" class="methodName">extendToGroupStart_</a></li><li data-type='method'><a href="EditableMathlist.html#extendToMathFieldEnd_" class="methodName">extendToMathFieldEnd_</a></li><li data-type='method'><a href="EditableMathlist.html#extendToMathFieldStart_" class="methodName">extendToMathFieldStart_</a></li><li data-type='method'><a href="EditableMathlist.html#extendToNextBoundary_" class="methodName">extendToNextBoundary_</a></li><li data-type='method'><a href="EditableMathlist.html#extendToNextChar_" class="methodName">extendToNextChar_</a></li><li data-type='method'><a href="EditableMathlist.html#extendToNextWord_" class="methodName">extendToNextWord_</a></li><li data-type='method'><a href="EditableMathlist.html#extendToPreviousBoundary_" class="methodName">extendToPreviousBoundary_</a></li><li data-type='method'><a href="EditableMathlist.html#extendToPreviousChar_" class="methodName">extendToPreviousChar_</a></li><li data-type='method'><a href="EditableMathlist.html#extendToPreviousWord_" class="methodName">extendToPreviousWord_</a></li><li data-type='method'><a href="EditableMathlist.html#extendUp_" class="methodName">extendUp_</a></li><li data-type='method' class='private'><a href="EditableMathlist.html#extractCharactersBeforeInsertionPoint" class="methodName">extractCharactersBeforeInsertionPoint</a></li><li data-type='method' class='private'><a href="EditableMathlist.html#extractCommandStringAroundInsertionPoint" class="methodName">extractCommandStringAroundInsertionPoint</a></li><li data-type='method' class='private'><a href="EditableMathlist.html#extractContents" class="methodName">extractContents</a></li><li data-type='method' class='private'><a href="EditableMathlist.html#extractContentsOrdInGroupBeforeInsertionPoint" class="methodName">extractContentsOrdInGroupBeforeInsertionPoint</a></li><li data-type='method' class='private'><a href="EditableMathlist.html#filter" class="methodName">filter</a></li><li data-type='method'><a href="EditableMathlist.html#insert" class="methodName">insert</a></li><li data-type='method' class='private'><a href="EditableMathlist.html#insertFirstAtom" class="methodName">insertFirstAtom</a></li><li data-type='method'><a href="EditableMathlist.html#isCollapsed" class="methodName">isCollapsed</a></li><li data-type='method' class='private'><a href="EditableMathlist.html#jump" class="methodName">jump</a></li><li data-type='method' class='private'><a href="EditableMathlist.html#leap" class="methodName">leap</a></li><li data-type='method'><a href="EditableMathlist.html#moveAfterParent_" class="methodName">moveAfterParent_</a></li><li data-type='method'><a href="EditableMathlist.html#moveBeforeParent_" class="methodName">moveBeforeParent_</a></li><li data-type='method'><a href="EditableMathlist.html#moveDown_" class="methodName">moveDown_</a></li><li data-type='method'><a href="EditableMathlist.html#moveToGroupEnd_" class="methodName">moveToGroupEnd_</a></li><li data-type='method'><a href="EditableMathlist.html#moveToGroupStart_" class="methodName">moveToGroupStart_</a></li><li data-type='method'><a href="EditableMathlist.html#moveToMathFieldEnd_" class="methodName">moveToMathFieldEnd_</a></li><li data-type='method'><a href="EditableMathlist.html#moveToMathFieldStart_" class="methodName">moveToMathFieldStart_</a></li><li data-type='method'><a href="EditableMathlist.html#moveToNextChar_" class="methodName">moveToNextChar_</a></li><li data-type='method'><a href="EditableMathlist.html#moveToNextPlaceholder_" class="methodName">moveToNextPlaceholder_</a></li><li data-type='method'><a href="EditableMathlist.html#moveToNextWord_" class="methodName">moveToNextWord_</a></li><li data-type='method'><a href="EditableMathlist.html#moveToOpposite_" class="methodName">moveToOpposite_</a></li><li data-type='method'><a href="EditableMathlist.html#moveToPreviousChar_" class="methodName">moveToPreviousChar_</a></li><li data-type='method'><a href="EditableMathlist.html#moveToPreviousPlaceholder_" class="methodName">moveToPreviousPlaceholder_</a></li><li data-type='method'><a href="EditableMathlist.html#moveToPreviousWord_" class="methodName">moveToPreviousWord_</a></li><li data-type='method'><a href="EditableMathlist.html#moveToSubscript_" class="methodName">moveToSubscript_</a></li><li data-type='method'><a href="EditableMathlist.html#moveToSuperscript_" class="methodName">moveToSuperscript_</a></li><li data-type='method'><a href="EditableMathlist.html#moveUp_" class="methodName">moveUp_</a></li><li data-type='method' class='private'><a href="EditableMathlist.html#next" class="methodName">next</a></li><li data-type='method'><a href="EditableMathlist.html#selectAll_" class="methodName">selectAll_</a></li><li data-type='method'><a href="EditableMathlist.html#selectGroup_" class="methodName">selectGroup_</a></li><li data-type='method' class='private'><a href="EditableMathlist.html#setExtent" class="methodName">setExtent</a></li><li data-type='method' class='private'><a href="EditableMathlist.html#setRange" class="methodName">setRange</a></li><li data-type='method' class='private'><a href="EditableMathlist.html#setSelection" class="methodName">setSelection</a></li><li data-type='method' class='private'><a href="EditableMathlist.html#sibling" class="methodName">sibling</a></li><li data-type='method' class='private'><a href="EditableMathlist.html#siblings" class="methodName">siblings</a></li><li data-type='method' class='private'><a href="EditableMathlist.html#skip" class="methodName">skip</a></li><li data-type='method' class='private'><a href="EditableMathlist.html#startOffset" class="methodName">startOffset</a></li><li data-type='method' class='private'><a href="EditableMathlist.html#toString" class="methodName">toString</a></li><li data-type='method'><a href="EditableMathlist.html#transpose_" class="methodName">transpose_</a></li></ul></li><li class="private"><a href="Lexer.html" class="className">Lexer</a><ul class='methods private'><li data-type='method' class='private'><a href="Lexer.html#end" class="methodName">end</a></li><li data-type='method' class='private'><a href="Lexer.html#get" class="methodName">get</a></li><li data-type='method' class='private'><a href="Lexer.html#isWhiteSpace" class="methodName">isWhiteSpace</a></li><li data-type='method' class='private'><a href="Lexer.html#makeToken" class="methodName">makeToken</a></li><li data-type='method' class='private'><a href="Lexer.html#peek" class="methodName">peek</a></li><li data-type='method' class='private'><a href="Lexer.html#scan" class="methodName">scan</a></li></ul></li><li class="private"><a href="MathAtom.html" class="className">MathAtom</a><ul class='methods private'><li data-type='method' class='private'><a href="MathAtom.html#.toSpeakableText" class="methodName">toSpeakableText</a></li><li data-type='method' class='private'><a href="MathAtom.html#bind" class="methodName">bind</a></li><li data-type='method' class='private'><a href="MathAtom.html#decompose" class="methodName">decompose</a></li><li data-type='method' class='private'><a href="MathAtom.html#decomposeGenfrac" class="methodName">decomposeGenfrac</a></li><li data-type='method' class='private'><a href="MathAtom.html#decomposeLeftright" class="methodName">decomposeLeftright</a></li><li data-type='method' class='private'><a href="MathAtom.html#decomposeLine" class="methodName">decomposeLine</a></li><li data-type='method' class='private'><a href="MathAtom.html#decomposeRule" class="methodName">decomposeRule</a></li><li data-type='method' class='private'><a href="MathAtom.html#filter" class="methodName">filter</a></li><li data-type='method' class='private'><a href="MathAtom.html#makeSpan" class="methodName">makeSpan</a></li></ul></li><li><a href="MathField.html" class="className">MathField</a><ul class='methods'><li data-type='method'><a href="MathField.html#$el" class="methodName">$el</a></li><li data-type='method'><a href="MathField.html#$insert" class="methodName">$insert</a></li><li data-type='method'><a href="MathField.html#$keystroke" class="methodName">$keystroke</a></li><li data-type='method'><a href="MathField.html#$latex" class="methodName">$latex</a></li><li data-type='method'><a href="MathField.html#$perform" class="methodName">$perform</a></li><li data-type='method'><a href="MathField.html#$revertToOriginalContent" class="methodName">$revertToOriginalContent</a></li><li data-type='method'><a href="MathField.html#$selectedText" class="methodName">$selectedText</a></li><li data-type='method'><a href="MathField.html#$selectionAtStart" class="methodName">$selectionAtStart</a></li><li data-type='method'><a href="MathField.html#$selectionDepth" class="methodName">$selectionDepth</a></li><li data-type='method'><a href="MathField.html#$selectionIsCollapsed" class="methodName">$selectionIsCollapsed</a></li><li data-type='method'><a href="MathField.html#$setConfig" class="methodName">$setConfig</a></li><li data-type='method'><a href="MathField.html#$text" class="methodName">$text</a></li><li data-type='method'><a href="MathField.html#$typedText" class="methodName">$typedText</a></li><li data-type='method' class='private'><a href="MathField.html#_getCaretPosition" class="methodName">_getCaretPosition</a></li><li data-type='method' class='private'><a href="MathField.html#_onKeystroke" class="methodName">_onKeystroke</a></li><li data-type='method' class='private'><a href="MathField.html#complete_" class="methodName">complete_</a></li><li data-type='method' class='private'><a href="MathField.html#enterCommandMode_" class="methodName">enterCommandMode_</a></li><li data-type='method' class='private'><a href="MathField.html#render" class="methodName">render</a></li><li data-type='method'><a href="MathField.html#selectionAtEnd" class="methodName">selectionAtEnd</a></li><li data-type='method'><a href="MathField.html#speakAll_" class="methodName">speakAll_</a></li><li data-type='method'><a href="MathField.html#speakAllWithSynchronizedHighlighting_" class="methodName">speakAllWithSynchronizedHighlighting_</a></li><li data-type='method'><a href="MathField.html#speakGroup_" class="methodName">speakGroup_</a></li><li data-type='method'><a href="MathField.html#speakLeftSibling_" class="methodName">speakLeftSibling_</a></li><li data-type='method'><a href="MathField.html#speakParent_" class="methodName">speakParent_</a></li><li data-type='method'><a href="MathField.html#speakRightSibling_" class="methodName">speakRightSibling_</a></li><li data-type='method'><a href="MathField.html#speakSelection_" class="methodName">speakSelection_</a></li><li data-type='method'><a href="MathField.html#speakSelectionWithSynchronizedHighlighting_" class="methodName">speakSelectionWithSynchronizedHighlighting_</a></li></ul></li><li class="private"><a href="module-mathstyle.Mathstyle.html" class="className">Mathstyle</a></li><li class="private"><a href="Parser.html" class="className">Parser</a><ul class='methods private'><li data-type='method' class='private'><a href="Parser.html#end" class="methodName">end</a></li><li data-type='method' class='private'><a href="Parser.html#hasLiteral" class="methodName">hasLiteral</a></li><li data-type='method' class='private'><a href="Parser.html#hasLiteralPattern" class="methodName">hasLiteralPattern</a></li><li data-type='method' class='private'><a href="Parser.html#hasToken" class="methodName">hasToken</a></li><li data-type='method' class='private'><a href="Parser.html#lastMathAtom" class="methodName">lastMathAtom</a></li><li data-type='method' class='private'><a href="Parser.html#parseAtom" class="methodName">parseAtom</a></li><li data-type='method' class='private'><a href="Parser.html#parseKeyword" class="methodName">parseKeyword</a></li><li data-type='method' class='private'><a href="Parser.html#parseLimits" class="methodName">parseLimits</a></li><li data-type='method' class='private'><a href="Parser.html#parseSupSub" class="methodName">parseSupSub</a></li><li data-type='method' class='private'><a href="Parser.html#parseToken" class="methodName">parseToken</a></li><li data-type='method' class='private'><a href="Parser.html#placeholder" class="methodName">placeholder</a></li><li data-type='method' class='private'><a href="Parser.html#scanArg" class="methodName">scanArg</a></li><li data-type='method' class='private'><a href="Parser.html#scanColor" class="methodName">scanColor</a></li><li data-type='method' class='private'><a href="Parser.html#scanDelim" class="methodName">scanDelim</a></li><li data-type='method' class='private'><a href="Parser.html#scanDimen" class="methodName">scanDimen</a></li><li data-type='method' class='private'><a href="Parser.html#scanEnvironment" class="methodName">scanEnvironment</a></li><li data-type='method' class='private'><a href="Parser.html#scanGroup" class="methodName">scanGroup</a></li><li data-type='method' class='private'><a href="Parser.html#scanImplicitGroup" class="methodName">scanImplicitGroup</a></li><li data-type='method' class='private'><a href="Parser.html#scanLeftRight" class="methodName">scanLeftRight</a></li><li data-type='method' class='private'><a href="Parser.html#scanMacro" class="methodName">scanMacro</a></li><li data-type='method' class='private'><a href="Parser.html#scanModeSet" class="methodName">scanModeSet</a></li><li data-type='method' class='private'><a href="Parser.html#scanModeShift" class="methodName">scanModeShift</a></li><li data-type='method' class='private'><a href="Parser.html#scanNumber" class="methodName">scanNumber</a></li><li data-type='method' class='private'><a href="Parser.html#scanString" class="methodName">scanString</a></li><li data-type='method' class='private'><a href="Parser.html#scanToken" class="methodName">scanToken</a></li></ul></li><li class="private"><a href="Span.html" class="className">Span</a></li><li class="private"><a href="Token.html" class="className">Token</a></li><li class="private"><a href="UndoManager.html" class="className">UndoManager</a><ul class='methods private'><li data-type='method' class='private'><a href="UndoManager.html#canRedo" class="methodName">canRedo</a></li><li data-type='method' class='private'><a href="UndoManager.html#canUndo" class="methodName">canUndo</a></li><li data-type='method' class='private'><a href="UndoManager.html#redo" class="methodName">redo</a></li><li data-type='method' class='private'><a href="UndoManager.html#restore" class="methodName">restore</a></li><li data-type='method' class='private'><a href="UndoManager.html#save" class="methodName">save</a></li><li data-type='method' class='private'><a href="UndoManager.html#snapshot" class="methodName">snapshot</a></li><li data-type='method' class='private'><a href="UndoManager.html#undo" class="methodName">undo</a></li></ul></li></ul><h3>Globals</h3><ul><li><a href="global.html#asLatex">asLatex</a></li><li><a href="global.html#asMachineNumber">asMachineNumber</a></li><li><a href="global.html#asSymbol">asSymbol</a></li><li><a href="global.html#escapeText">escapeText</a></li><li><a href="global.html#expandLayerMarkup">expandLayerMarkup</a></li><li><a href="global.html#formatMantissa">formatMantissa</a></li><li><a href="global.html#getCanonicalName">getCanonicalName</a></li><li><a href="global.html#getLatexForSymbol">getLatexForSymbol</a></li><li><a href="global.html#getLatexTemplateForFunction">getLatexTemplateForFunction</a></li><li><a href="global.html#getLatexTemplateForOperator">getLatexTemplateForOperator</a></li><li><a href="global.html#getPrecedence">getPrecedence</a></li><li><a href="global.html#getSymbol">getSymbol</a></li><li><a href="global.html#getType">getType</a></li><li><a href="global.html#isAtom">isAtom</a></li><li><a href="global.html#isSuperscriptAtom">isSuperscriptAtom</a></li><li><a href="global.html#latexify">latexify</a></li><li><a href="global.html#make">make</a></li><li><a href="global.html#makeKeyboardToolbar">makeKeyboardToolbar</a></li><li><a href="global.html#negate">negate</a></li><li><a href="global.html#numberAsLatex">numberAsLatex</a></li><li><a href="global.html#opPrec">opPrec</a></li><li><a href="global.html#parse">parse</a></li><li><a href="global.html#parseDelim">parseDelim</a></li><li><a href="global.html#parseDigraph">parseDigraph</a></li><li><a href="global.html#parseExpression">parseExpression</a></li><li><a href="global.html#parsePostfix">parsePostfix</a></li><li><a href="global.html#parseSupsub">parseSupsub</a></li><li><a href="global.html#parseTokens">parseTokens</a></li><li><a href="global.html#toMathML">toMathML</a></li><li><a href="global.html#validateFence">validateFence</a></li></ul><div class="checkbox"><input id="toggle-private" type="checkbox" onclick="
if (!document.getElementById('toggle-private').checked) {
document.documentElement.classList.add('no-private')
writeCookie('symbol-access', 'no-private')
} else {
document.documentElement.classList.remove('no-private')
writeCookie('symbol-access', 'private')
}
"><label for="toggle-private">Include Private Symbols</label></div></div>
        <footer role="contentInfo">
            Made with <a href="https://github.com/jsdoc3/jsdoc">JSDoc 3.5.5</a>. 
            
        </footer>
    </nav>
</section>

<main id="main">
    
        <h1 class="page-title">editor/editor-virtualKeyboard.js</h1>
    

    



    
    <section class="source">
        <article>
            <pre class="prettyprint source linenums">
            
            <code>import MathAtom from '../core/mathAtom.js';
import Span from '../core/span.js';
import Lexer from '../core/lexer.js';
import ParserModule from '../core/parser.js';
import Color from '../core/color.js';
import '../core/definitions.js';
import '../addons/outputLatex.js';
import './editor-popover.js';
import './editor-keyboard.js';
import './editor-shortcuts.js';

const KEYBOARDS = {
    'numeric': {
        tooltip: 'Numeric',
        layer: 'math',
        label: '123',
        layers: ['math']
    },
    'roman': {
        tooltip: 'Symbols and Roman Letters',
        layer: 'lower-roman',
        label: 'ABC',
        layers: ['lower-roman', 'upper-roman', 'symbols']
    },
    'greek': {
        tooltip: 'Greek Letters',
        layer: 'lower-greek',
        label: '&amp;alpha;&amp;beta;&amp;gamma;',
        classes: 'tex-math',
        layers: ['lower-greek', 'upper-greek']
    },
    'functions': {
        tooltip: 'Functions',
        layer: 'functions',
        label: '&lt;i>f&lt;/i>&amp;thinsp;()',
        classes: 'tex',
        layers: ['functions']
    },
    'command': {
        tooltip: 'LaTeX Command Mode',
        // For the command keyboard, perform a command rather than
        // doing a simple layer switch, as we want to enter command mode
        // when the keyboard is activated
        command: 'enterCommandMode',
        label: `&lt;svg>&lt;use xlink:href='#svg-command' />&lt;/svg>`,
        layers: ['lower-command', 'upper-command', 'symbols-command']
    }
}

const SHIFTED_KEYS = {
    '\\varphi ': {label: '&amp;Phi;', insert: '\\Phi '},
    '\\varsigma ': {label: '&amp;Sigma;', insert: '\\Sigma '},
    '\\epsilon ': {label: '&amp;#x0190;', insert: '{\\char"0190}'},
    '\\rho ': {label: '&amp;#x3A1', insert: '{\\char"3A1}'},
    '\\tau ': {label: '&amp;#x3A4;', insert: '{\\char"3A4}'},
    '\\upsilon ': {label: '&amp;Upsilon;', insert: '\\Upsilon '},
    '\\theta ': {label: '&amp;Theta;', insert: '\\Theta '},
    '\\iota ': {label: '&amp;Iota;', insert: '{\\char"399}'},
    '\\omicron ': {label: '&amp;#x039F;', insert: '{\\char"39F}'},
    '\\pi ': {label: '&amp;Pi;', insert: '\\Pi '},
    '\\alpha ': {label: '&amp;Alpha;', insert: '{\\char"391}'},
    '\\sigma ': {label: '&amp;Sigma;', insert: '\\Sigma '},
    '\\delta ': {label: '&amp;Delta;', insert: '\\Delta '},
    '\\phi ': {label: '&amp;#x03a6;', insert: '\\Phi '},
    '\\gamma ': {label: '&amp;Gamma;', insert: '\\Gamma '},
    '\\eta ': {label: '&amp;Eta;', insert: '{\\char"397}'},
    '\\xi ': {label: '&amp;Xi;', insert: '\\Xi '},
    '\\kappa ': {label: '&amp;Kappa;', insert: '{\\char"39A}'},
    '\\lambda ': {label: '&amp;Lambda;', insert: '\\Lambda '},
    '\\zeta ': {label: '&amp;Zeta;', insert: '{\\char"396}'},
    '\\chi ': {label: '&amp;Chi;', insert: '{\\char"3A7}'},
    '\\psi ': {label: '&amp;Psi;', insert: '\\Psi '},
    '\\omega ': {label: '&amp;Omega;', insert: '\\Omega '},
    '\\beta ': {label: '&amp;Beta;', insert: '{\\char"392}'},
    '\\nu ': {label: '&amp;Nu;', insert: '{\\char"39D}'},
    '\\mu ': {label: '&amp;Mu;', insert: '{\\char"39C}'}
}

// const FUNCTIONS = [
//     'Basic',
//         ['\\sin', '\\cos', '\\tan', '\\min', '\\max', '\\gcd', '\\lcm', '\\repeat', 'encapsulate', 'recognize'],
//     'Operators',
//         ['\\sum', '\\prod', '\\bigcup_x']
// ]
const ALT_KEYS_BASE = {
    '0': ['\\emptyset', '\\varnothing', '\\infty', {latex: '#?_0', insert: '#@_0'},
            '\\circ', '\\bigcirc', '\\bullet'],
    '2': ['\\frac{1}{2}', {latex: '#?^2', insert: '#@^2' }],
    '3': ['\\frac{1}{3}', {latex: '#?^3', insert: '#@^3' }],
    '.': [
        ',',  ';', '\\colon',  {latex:':', aside:'ratio'},
        {latex:'\\cdotp', aside:'center dot', classes:'box'},
        {latex:'\\cdots', aside:'center ellipsis', classes:'box'},
        {latex:'\\ldotp', aside:'low dot', classes:'box'} ,
        {latex:'\\ldots', aside:'low ellipsis', classes:'box'} ,
        {latex:'\\vdots', aside:'', classes:'box'} ,
        {latex:'\\ddots', aside:'', classes:'box'} ,
        '\\odot', '\\oslash', '\\circledcirc',

    ],

    '*': [
        '\\cdot', '\\ast', '\\star', '\\bigstar',
        '\\ltimes', '\\rtimes', '\\rightthreetimes','\\leftthreetimes',
        '\\intercal', '\\prod', {latex:'\\prod_{n\\mathop=0}^{\\infty}', classes:'small'},
    ],

    '+': [
        '\\pm', '\\mp',
        '\\sum', {latex:'\\sum_{n\\mathop=0}^{\\infty}', classes:'small'},
        '\\dotplus', '\\oplus'
    ],
    '-': [
        '\\pm', '\\mp',
        '\\ominus', '\\vert #0  \\vert'
    ],

    '/': ['\\divideontimes', '/', '\\div'],

    '(':[
        '\\left( #0\\right)', '\\left[ #0\\right]', '\\left\\{ #0\\right\\}', '\\left\\langle #0\\right\\rangle',
        '\\lfloor',    '\\llcorner',    '(',            '\\lbrack',
        '\\lvert',     '\\lVert',       '\\lgroup',     '\\langle',
        '\\lceil',     '\\ulcorner',    '\\lmoustache', '\\lbrace',
    ],

    ')':[
        '\\rfloor',    '\\lrcorner',    ')',            '\\rbrack',
        '\\rvert',     '\\rVert',       '\\rgroup',     '\\rangle',
        '\\rceil',     '\\urcorner',    '\\rmoustache', '\\rbrace',
    ],

    '=': [
        '\\cong',       '\\asymp', '\\equiv',
        '\\differencedelta',    '\\varpropto',
        '\\thickapprox', '\\approxeq', '\\thicksim', '\\backsim', '\\eqsim', '\\simeq',
        '\\Bumpeq', '\\bumpeq', '\\doteq', '\\Doteq',
        '\\fallingdotseq', '\\risingdotseq', '\\coloneq', '\\eqcirc', '\\circeq',
        '\\triangleq', '\\between',
    ],

    '!=': [
        '\\neq', '\\ncong',    '',
        '\\nsim',
    ],

    '&lt;': [
        '\\leq', '\\leqq', '\\lneqq', '\\ll', '\\nless', '\\nleq',
        '\\precsim', '\\lesssim', '\\lessgtr', '\\prec', '\\preccurlyeq', '\\lessdot',
        '\\nprec',
    ],

    '>': [
        '\\geq', '\\geqq', '\\gneqq', '\\gg', '\\ngtr', '\\ngeq',
        '\\succsim', '\\gtrsim', '\\gtrless', '\\succ', '\\succcurlyeq', '\\gtrdot',
        '\\nsucc'
     ],

    'set': [
        '\\in', '\\owns',
        '\\subset', '\\nsubset', '\\supset', '\\nsupset'
    ],

    '!set': [
        '\\notin', '\\backepsilon'
    ],

    'subset': [],
    'supset': [],

    'infinity': ['\\aleph_0', '\\aleph_1', '\\omega', '\\mathfrak{m}'],


    'numeric-pi': ['\\prod', '\\theta', '\\rho',
        '\\sin', '\\cos', '\\tan'
    ],


    'ee': [
            '\\times 10^{#?}',
            '\\ln', '\\ln_{10}', '\\log'
        ],

    '^':  ['_{#?}'],

    // Integrals
    'int': [
            {latex:'\\int_{#?}^{#?}', classes:'small'},
            {latex:'\\int', classes:'small'},
            {latex:'\\smallint', classes:'small'},
            {latex:'\\iint', classes:'small'},
            {latex:'\\iiint', classes:'small'},
            {latex:'\\oint', classes:'small'},
            {latex: '\\dfrac{\\rd}{\\rd x}',  classes:'small'},
            {latex:'\\frac{\\partial}{\\partial x}', classes:'small'},

            '\\capitalDifferentialD', '\\rd',  '\\partial',
    ],

    'nabla': ['\\nabla\\times', '\\nabla\\cdot', '\\nabla^{2}'],

    '!':    ['!!', '\\Gamma', '\\Pi'],
    'accents': ['\\bar{#@}', '\\vec{#@}', '\\hat{#@}', '\\check{#@}',
        '\\dot{#@}', '\\ddot{#@}', '\\mathring{#@}', '\\breve{#@}',
        '\\acute{#@}', '\\tilde{#@}', '\\grave{#@}'],
    // 'absnorm': [{latex:'\\lVert #@ \\rVert', aside:'norm'},
    //     {latex:'\\lvert #@ \\rvert', aside:'determinant'},
    //     {latex:'\\begin{cardinality} #@ \\end{cardinality}', aside:'cardinality'},
    //     {latex:'\\lvert #@ \\rvert', aside:'length'},
    //     {latex:'\\lvert #@ \\rvert', aside:'order'},

    // ],
    'A':        [{latex:'\\aleph', aside:'aleph'},
                {latex:'\\forall', aside:'for all'},
    ],
    'a':        [{latex:'\\aleph', aside:'aleph'},
                {latex:'\\forall', aside:'for all'},
    ],
    'b':        [{latex:'\\beth', aside:'beth'}],
    'B':        [{latex:'\\beth', aside:'beth'}],
    'c':        [{latex:'\\C', aside:'set of complex numbers'}],
    'd':        [{latex:'\\daleth', aside:'daleth'}],
    'D':        [{latex:'\\daleth', aside:'daleth'}],
    'e':        [{latex:'\\exponentialE', aside:'exponential e'},
                {latex:'\\exists', aside:'there is'},
                {latex:'\\nexists', aside:'there isn’t'},
    ],
    'g':        [{latex:'\\gimel', aside:'gimel'}],
    'G':        [{latex:'\\gimel', aside:'gimel'}],
    'h':        [{latex:'\\hbar',  aside:'h bar'},
                    {latex: '\\hslash', aside:'h slash'}
    ],
    'i':        [{latex:'\\imaginaryI', aside:'imaginary i'}],
    'j':        [{latex:'\\imaginaryJ', aside:'imaginary j'}],
    'l':        [{latex:'\\ell', aside:'ell'}],
    'n':        [{latex:'\\N', aside:'set of natural numbers'}],
    'p':        [{latex:'\\P', aside:'set of primes'}],
    'q':        [{latex:'\\Q', aside:'set of rational numbers'}],
    'r':        [{latex:'\\R', aside:'set of real numbers'}],
    'z':        [{latex:'\\Z', aside:'set of integers'}],

    'x-var': ['y', 'z', 't', 'r',
            {latex:'f(#?)', classes:'small'}, {latex:'g(#?)', classes:'small'}, 'x^2', 'x^n',
            'x_n', 'x_{n+1}', 'x_i', 'x_{i+1}'],
    'n-var': ['i', 'j', 'p', 'k', 'a', 'u'],
    'ii': ['\\Re', '\\Im', '\\imaginaryJ', '\\Vert #0 \\Vert'],

    'logic': [
        {latex:'\\exists', aside:'there is'},
        {latex:'\\nexists', aside:'there isn’t'},

        {latex:'\\ni', aside:'such that'},
        {latex:'\\Colon', aside:'such that'},

        {latex:'\\implies', aside:'implies'},
        {latex:'\\impliedby', aside:'implied by'},

        {latex:'\\iff', aside:'if and only if'},


        {latex:'\\land', aside:'and'},
        {latex:'\\lor', aside:'or'},
        {latex:'\\oplus', aside:'xor'},
        {latex:'\\lnot', aside:'not'},

        {latex:'\\downarrow', aside:'nor'},
        {latex:'\\uparrow', aside:'nand'},

        {latex:'\\curlywedge', aside:'nor'},
        {latex:'\\bar\\curlywedge', aside:'nand'},


        // {latex:'\\barwedge', aside:'bar wedge'},
        // {latex:'\\curlyvee', aside:'curly vee'},
        // {latex:'\\veebar', aside:'vee bar'},

        {latex:'\\therefore', aside:'therefore'},
        {latex:'\\because', aside:'because'},

        {latex:'^\\biconditional', aside:'biconditional'},

        '\\leftrightarrow', '\\Leftrightarrow', '\\to',
        '\\models', '\\vdash', '\\gets', '\\dashv',
        '\\roundimplies'],

    'set-operators':
        ['\\cap', '\\cup', '\\setminus', '\\smallsetminus',
        '\\complement'],

    'set-relations': [
        '\\in', '\\notin', '\\ni', '\\owns', '\\subset', '\\supset',
        '\\subseteq', '\\supseteq', '\\subsetneq', '\\supsetneq',
        '\\varsubsetneq', '\\subsetneqq', '\\nsubset', '\\nsupset',
        '\\nsubseteq', '\\nsupseteq'
    ],

    'space': [
        {latex: '\\char"203A\\!\\char"2039', insert: '\\!', aside:'negative thin space&lt;br>⁻³⧸₁₈ em'},
        {latex: '\\unicode{"203A}\\,\\unicode{"2039}', insert: '\\,', aside:'thin space&lt;br>³⧸₁₈ em'},
        {latex: '\\unicode{"203A}\\:\\unicode{"2039}', insert: '\\:', aside:'medium space&lt;br>⁴⧸₁₈ em'},
        {latex: '\\unicode{"203A}\\;\\unicode{"2039}', insert: '\\;', aside:'thick space&lt;br>⁵⧸₁₈ em'},
        {latex: '\\unicode{"203A}\\ \\unicode{"2039}', insert: '\\ ', aside:'⅓ em'},
        {latex: '\\unicode{"203A}\\enspace\\unicode{"2039}', insert: '\\enspace', aside:'½ em'},
        {latex: '\\unicode{"203A}\\quad\\unicode{"2039}', insert: '\\quad', aside:'1 em'},
        {latex: '\\unicode{"203A}\\qquad\\unicode{"2039}', insert: '\\qquad', aside:'2 em'}
    ],

    // @todo could also delete to end
    'delete': [{label: '&lt;span class="warning">&lt;svg>&lt;use xlink:href="#svg-trash" />&lt;/svg>&lt;/span>',
                command: '"deleteAll"' }],

    // @todo Tab: could turn on speech, visible keyboard...
    '->|': []

};
let ALT_KEYS = {};

const LAYERS = {
    'math': `
        &lt;div class='rows'>
            &lt;ul>
                &lt;li class='keycap tex' data-alt-keys='x-var'>&lt;i>x&lt;/i>&lt;/li>
                &lt;li class='keycap tex' data-alt-keys='n-var'>&lt;i>n&lt;/i>&lt;/li>
                &lt;li class='separator w5'>&lt;/li>
                &lt;row name='numpad-1'/>
                &lt;li class='separator w5'>&lt;/li>
                &lt;li class='keycap tex' data-key='ee' data-alt-keys='ee'>e&lt;/li>
                &lt;li class='keycap tex' data-key='ii' data-alt-keys='ii'>i&lt;/li>
                &lt;li class='keycap tex' data-latex='\\pi' data-alt-keys='numeric-pi'>&lt;/li>
            &lt;/ul>
            &lt;ul>
                &lt;li class='keycap tex' data-key='&lt;' data-alt-keys='&lt;'>&amp;lt;&lt;/li>
                &lt;li class='keycap tex' data-key='>' data-alt-keys='>'>&amp;gt;&lt;/li>
                &lt;li class='separator w5'>&lt;/li>
                &lt;row name='numpad-2'/>
                &lt;li class='separator w5'>&lt;/li>
                &lt;li class='keycap tex' data-alt-keys='x2' data-insert='#@^{2}'>&lt;span>&lt;i>x&lt;/i>&amp;thinsp;²&lt;/span>&lt;/li>
                &lt;li class='keycap tex' data-alt-keys='^' data-insert='#@^{#?}'>&lt;span>&lt;i>x&lt;/i>&lt;sup>&amp;thinsp;&lt;small>&amp;#x2b1a;&lt;/small>&lt;/sup>&lt;/span>&lt;/li>
                &lt;li class='keycap tex' data-alt-keys='sqrt' data-insert='\\sqrt{#0}' data-latex='\\sqrt{#0}'>&lt;/li>
            &lt;/ul>
            &lt;ul>
                &lt;li class='keycap tex' data-alt-keys='(' >(&lt;/li>
                &lt;li class='keycap tex' data-alt-keys=')' >)&lt;/li>
                &lt;li class='separator w5'>&lt;/li>
                &lt;row name='numpad-3'/>
                &lt;li class='separator w5'>&lt;/li>
                &lt;li class='keycap tex small' data-alt-keys='int' data-latex='\\int_0^\\infty'>&lt;span>&lt;/span>&lt;/li>
                &lt;li class='keycap tex' data-latex='\\forall' data-alt-keys='logic' >&lt;/li>
                &lt;li class='action font-glyph bottom right' data-alt-keys='delete' data-command='["performWithFeedback","deletePreviousChar"]'>&amp;#x232b;&lt;/li>&lt;/ul>
            &lt;/ul>
            &lt;ul>
                &lt;li class='keycap' data-alt-keys='foreground-color' data-command='["applyStyle",{"color":"#cc2428"}]'>&lt;span style='border-radius: 50%;width:22px;height:22px; background:#cc2428'>&lt;/span>&lt;aside>text&lt;/aside>&lt;/li>
                &lt;li class='keycap' data-alt-keys='background-color' data-command='["applyStyle",{"backgroundColor":"#fff590"}]'>&lt;span style='border-radius: 50%;width:22px;height:22px; background:#fff590'>&lt;/span>&lt;aside>highlight&lt;/aside>&lt;/li>
                &lt;li class='separator w5'>&lt;/li>
                &lt;row name='numpad-4'/>
                &lt;li class='separator w5'>&lt;/li>
                &lt;arrows/>
            &lt;/ul>
        &lt;/div>
    `,
    'lower-roman': `
        &lt;div class='rows'>
            &lt;ul>
                &lt;row name='numpad-1' class='if-wide'/>
                &lt;row name='lower-1' shift-layer='upper-roman'/>
            &lt;/ul>
            &lt;ul>
                &lt;row name='numpad-2' class='if-wide'/>
                &lt;row name='lower-2'  shift-layer='upper-roman''/>
            &lt;/ul>
            &lt;ul>
                &lt;row name='numpad-3' class='if-wide'/>
                &lt;row name='lower-3'  shift-layer='upper-roman''/>
            &lt;/ul>
            &lt;ul>
                &lt;row name='numpad-4' class='if-wide'/>
                &lt;li class='layer-switch font-glyph modifier bottom left' data-layer='symbols'>&amp;infin;≠&lt;/li>
                &lt;li class='keycap' data-alt-keys=','>,&lt;/li>
                &lt;li class='keycap w50' data-key=' ' data-alt-keys='space'>&amp;nbsp;&lt;/li>
                &lt;arrows/>
            &lt;/ul>
        &lt;/div>`,
    'upper-roman': `
        &lt;div class='rows'>
            &lt;ul>
                &lt;row name='numpad-1' class='if-wide'/>
                &lt;row name='upper-1'  shift-layer='lower-roman'/>
            &lt;/ul>
            &lt;ul>
                &lt;row name='numpad-2' class='if-wide'/>
                &lt;row name='upper-2' shift-layer='lower-roman'/>
            &lt;/ul>
            &lt;ul>
                &lt;row name='numpad-3' class='if-wide'/>
                &lt;row name='upper-3' shift-layer='lower-roman'/>
            &lt;/ul>
            &lt;ul>
                &lt;row name='numpad-4' class='if-wide'/>
                &lt;li class='layer-switch font-glyph modifier bottom left' data-layer='symbols'>&amp;infin;≠&lt;/li>
                &lt;li class='keycap' data-alt-keys='.'>;&lt;/li>
                &lt;li class='keycap w50' data-key=' '>&amp;nbsp;&lt;/li>
                &lt;arrows/>
            &lt;/ul>
        &lt;/div>`,
    'symbols': `
        &lt;div class='rows'>
            &lt;ul>
                &lt;row name='numpad-1' class='if-wide'/>
                &lt;li class='keycap tex' data-alt-keys='(' data-insert='\\lbrace '>{&lt;/li>
                &lt;li class='keycap tex' data-alt-keys=')' data-insert='\\rbrace '>}&lt;/li>
                &lt;li class='separator w5'>&lt;/li>
                &lt;li class='keycap tex' data-alt-keys='set' data-insert='\\in '>&amp;#x2208;&lt;/li>
                &lt;li class='keycap tex' data-alt-keys='!set' data-insert='\\notin '>&amp;#x2209;&lt;/li>
                &lt;li class='keycap tex' data-insert='\\Re '>&amp;#x211c;&lt;aside>Real&lt;/aside>&lt;/li>
                &lt;li class='keycap tex' data-insert='\\Im '>&amp;#x2111;&lt;aside>Imaginary&lt;/aside>&lt;/li>
                &lt;li class='keycap w15' data-insert='\\ulcorner#0\\urcorner '>&lt;span>&lt;sup>&amp;#x250c;&lt;/sup>&lt;span>&lt;span style='color:#ddd'>o&lt;/span>&lt;sup>&amp;#x2510;&lt;/sup>&lt;/span>&lt;aside>ceil&lt;/aside>&lt;/li>
                &lt;li class='keycap tex' data-alt-keys='nabla' data-insert='\\nabla '>&amp;#x2207;&lt;aside>nabla&lt;/aside>&lt;/li>
                &lt;li class='keycap tex' data-alt-keys='infinity' data-insert='\\infty '>&amp;#x221e;&lt;/li>

            &lt;/ul>
            &lt;ul>
                &lt;row name='numpad-2' class='if-wide'/>
                &lt;li class='keycap tex' data-alt-keys='(' data-insert='\\lbrack '>[&lt;/li>
                &lt;li class='keycap tex' data-alt-keys=')' data-insert='\\rbrack '>]&lt;/li>
                &lt;li class='separator w5'>&lt;/li>
                &lt;li class='keycap tex' data-alt-keys='subset' data-insert='\\subset '>&amp;#x2282;&lt;/li>
                &lt;li class='keycap tex' data-alt-keys='supset' data-insert='\\supset '>&amp;#x2283;&lt;/li>
                &lt;li class='keycap tex' data-key='!' data-alt-keys='!'>!&lt;aside>factorial&lt;/aside>&lt;/li>
                &lt;li class='keycap' data-insert='^\\prime '>&lt;span>&lt;sup>&lt;span>&lt;span style='color:#ddd'>o&lt;/span>&amp;#x2032&lt;/sup>&lt;/span>&lt;aside>prime&lt;/aside>&lt;/li>
                &lt;li class='keycap w15' data-insert='\\llcorner#0\\lrcorner '>&lt;span>&lt;sub>&amp;#x2514;&lt;/sub>&lt;span style='color:#ddd'>o&lt;/span>&lt;sub>&amp;#x2518;&lt;/sub>&lt;/span>&lt;aside>floor&lt;/aside>&lt;/li>
                &lt;li class='keycap tex' data-insert='\\partial '>&amp;#x2202;&lt;aside>partial&lt;br>derivative&lt;/aside>&lt;/li>
                &lt;li class='keycap tex' data-insert='\\emptyset '>&amp;#x2205;&lt;aside>empty set&lt;/aside>&lt;/li>

            &lt;/ul>
            &lt;ul>
                &lt;row name='numpad-3' class='if-wide'/>
                &lt;li class='keycap tex' data-alt-keys='(' data-insert='\\langle '>&amp;#x27e8;&lt;/li>
                &lt;li class='keycap tex' data-alt-keys=')' data-insert='\\rangle '>&amp;#x27e9;&lt;/li>
                &lt;li class='separator w5'>&lt;/li>
                &lt;li class='keycap tex' data-insert='\\subseteq '>&amp;#x2286;&lt;/li>
                &lt;li class='keycap tex' data-insert='\\supseteq '>&amp;#x2287;&lt;/li>
                &lt;li class='keycap tex' data-alt-keys='accents' data-insert='\\vec{#@}' data-latex='\\vec{#?}' data-aside='vector'>&lt;/li>
                &lt;li class='keycap tex' data-alt-keys='accents' data-insert='\\bar{#@}' data-latex='\\bar{#?}' data-aside='bar'>&lt;/li>
                &lt;li class='keycap tex' data-alt-keys='absnorm' data-insert='\\lvert #@ \\rvert ' data-latex='\\lvert #? \\rvert' data-aside='abs'>&lt;/li>
                &lt;li class='keycap tex' data-insert='\\ast '>&amp;#x2217;&lt;aside>asterisk&lt;/aside>&lt;/li>

                &lt;li class='action font-glyph bottom right w15'
                    data-shifted='&lt;span class="warning">&lt;svg>&lt;use xlink:href="#svg-trash" />&lt;/svg>&lt;/span>'
                    data-shifted-command='"deleteAll"'
                    data-alt-keys='delete' data-command='["performWithFeedback","deletePreviousChar"]'
                >&amp;#x232b;&lt;/li>
            &lt;/ul>
            &lt;ul>
                &lt;row name='numpad-4' class='if-wide'/>
                &lt;li class='layer-switch font-glyph modifier bottom left' data-layer='lower-roman'>abc&lt;/li>
                &lt;li class='keycap tex' data-insert='\\cdot '>&amp;#x22c5;&lt;aside>centered dot&lt;/aside>&lt;/li>
                &lt;li class='keycap tex' data-insert='\\colon '>:&lt;aside>colon&lt;/aside>&lt;/li>
                &lt;li class='keycap tex' data-insert='\\circ '>&amp;#x2218;&lt;aside>circle&lt;/aside>&lt;/li>
                &lt;li class='keycap tex' data-insert='\\approx '>&amp;#x2248;&lt;aside>approx.&lt;/aside>&lt;/li>
                &lt;li class='keycap tex' data-insert='\\ne '>&amp;#x2260;&lt;/li>
                &lt;li class='keycap tex' data-insert='\\pm '>&amp;#x00b1;&lt;/li>
                &lt;arrows/>
            &lt;/ul>
        &lt;/div>`,
    'lower-greek': `
        &lt;div class='rows'>
            &lt;ul>&lt;li class='keycap tex' data-insert='\\varphi '>&lt;i>&amp;#x03c6;&lt;/i>&lt;aside>phi var.&lt;/aside>&lt;/li>
                &lt;li class='keycap tex' data-insert='\\varsigma '>&lt;i>&amp;#x03c2;&lt;/i>&lt;aside>sigma var.&lt;/aside>&lt;/li>
                &lt;li class='keycap tex' data-insert='\\epsilon '>&lt;i>&amp;#x03f5;&lt;/i>&lt;/li>
                &lt;li class='keycap tex' data-insert='\\rho '>&lt;i>&amp;rho;&lt;/i>&lt;/li>
                &lt;li class='keycap tex' data-insert='\\tau '>&lt;i>&amp;tau;&lt;/i>&lt;/li>
                &lt;li class='keycap tex' data-insert='\\upsilon '>&lt;i>&amp;upsilon;&lt;/i>&lt;/li>
                &lt;li class='keycap tex' data-insert='\\theta '>&lt;i>&amp;theta;&lt;/i>&lt;/li>
                &lt;li class='keycap tex' data-insert='\\iota '>&lt;i>&amp;iota;&lt;/i>&lt;/li>
                &lt;li class='keycap tex' data-insert='\\omicron '>&amp;omicron;&lt;/i>&lt;/li>
                &lt;li class='keycap tex' data-insert='\\pi '>&lt;i>&amp;pi;&lt;/i>&lt;/li>
            &lt;/ul>
            &lt;ul>&lt;li class='keycap tex' data-insert='\\alpha ' data-shifted='&amp;Alpha;' data-shifted-command='["insert","{\\\\char\\"391}"]'>&lt;i>&amp;alpha;&lt;/i>&lt;/li>
                &lt;li class='keycap tex' data-insert='\\sigma '>&lt;i>&amp;sigma;&lt;/i>&lt;/li>
                &lt;li class='keycap tex' data-insert='\\delta '>&lt;i>&amp;delta;&lt;/i>&lt;/li>
                &lt;li class='keycap tex' data-insert='\\phi '>&lt;i>&amp;#x03d5;&lt;/i>&lt;/i>&lt;/li>
                &lt;li class='keycap tex' data-insert='\\gamma '>&lt;i>&amp;gamma;&lt;/i>&lt;/li>
                &lt;li class='keycap tex' data-insert='\\eta '>&lt;i>&amp;eta;&lt;/i>&lt;/li>
                &lt;li class='keycap tex' data-insert='\\xi '>&lt;i>&amp;xi;&lt;/i>&lt;/li>
                &lt;li class='keycap tex' data-insert='\\kappa '>&lt;i>&amp;kappa;&lt;/i>&lt;/li>
                &lt;li class='keycap tex' data-insert='\\lambda '>&lt;i>&amp;lambda;&lt;/i>&lt;/li>
            &lt;/ul>
            &lt;ul>&lt;li class='shift modifier font-glyph bottom left w15 layer-switch' data-layer='upper-greek'>&amp;#x21e7;&lt;/li>
                &lt;li class='keycap tex' data-insert='\\zeta '>&lt;i>&amp;zeta;&lt;/i>&lt;/li>
                &lt;li class='keycap tex' data-insert='\\chi '>&lt;i>&amp;chi;&lt;/i>&lt;/li>
                &lt;li class='keycap tex' data-insert='\\psi '>&lt;i>&amp;psi;&lt;/i>&lt;/li>
                &lt;li class='keycap tex' data-insert='\\omega '>&lt;i>&amp;omega;&lt;/i>&lt;/li>
                &lt;li class='keycap tex' data-insert='\\beta '>&lt;i>&amp;beta;&lt;/i>&lt;/li>
                &lt;li class='keycap tex' data-insert='\\nu '>&lt;i>&amp;nu;&lt;/i>&lt;/li>
                &lt;li class='keycap tex' data-insert='\\mu '>&lt;i>&amp;mu;&lt;/i>&lt;/li>
                &lt;li class='action font-glyph bottom right w15'
                    data-shifted='&lt;span class="warning">&lt;svg>&lt;use xlink:href="#svg-trash" />&lt;/svg>&lt;/span>'
                    data-shifted-command='"deleteAll"'
                    data-alt-keys='delete' data-command='["performWithFeedback","deletePreviousChar"]'
                >&amp;#x232b;&lt;/li>
            &lt;/ul>
            &lt;ul>
                &lt;li class='keycap ' data-key=' '>&amp;nbsp;&lt;/li>
                &lt;li class='keycap'>,&lt;/li>
                &lt;li class='keycap tex' data-insert='\\varepsilon '>&lt;i>&amp;#x03b5;&lt;/i>&lt;aside>epsilon var.&lt;/aside>&lt;/li>
                &lt;li class='keycap tex' data-insert='\\vartheta '>&lt;i>&amp;#x03d1;&lt;/i>&lt;aside>theta var.&lt;/aside>&lt;/li>
                &lt;li class='keycap tex' data-insert='\\varkappa '>&lt;i>&amp;#x3f0;&lt;/i>&lt;aside>kappa var.&lt;/aside>&lt;/li>
                &lt;li class='keycap tex' data-insert='\\varpi '>&lt;i>&amp;#x03d6;&lt;aside>pi var.&lt;/aside>&lt;/i>&lt;/li>
                &lt;li class='keycap tex' data-insert='\\varrho '>&lt;i>&amp;#x03f1;&lt;/i>&lt;aside>rho var.&lt;/aside>&lt;/li>
                &lt;arrows/>
            &lt;/ul>
        &lt;/div>`,
    'upper-greek': `
        &lt;div class='rows'>
            &lt;ul>&lt;li class='keycap tex' data-insert='\\Phi '>&amp;Phi;&lt;aside>phi&lt;/aside>&lt;/li>
                &lt;li class='keycap tex' data-insert='\\Sigma '>&amp;Sigma;&lt;aside>sigma&lt;/aside>&lt;/li>
                &lt;li class='keycap tex' data-insert='{\\char"0190}'>&amp;#x0190;&lt;aside>epsilon&lt;/aside>&lt;/li>
                &lt;li class='keycap tex' data-insert='{\\char"3A1}'>&amp;#x3A1;&lt;aside>rho&lt;/aside>&lt;/li>
                &lt;li class='keycap tex' data-insert='{\\char"3A4}'>&amp;#x3A4;&lt;aside>tau&lt;/aside>&lt;/li>
                &lt;li class='keycap tex' data-insert='\\Upsilon '>&amp;Upsilon;&lt;aside>upsilon&lt;/aside>&lt;/li>
                &lt;li class='keycap tex' data-insert='\\Theta '>&amp;Theta;&lt;aside>theta&lt;/aside>&lt;/li>
                &lt;li class='keycap tex' data-insert='{\\char"399}'>&amp;Iota;&lt;aside>iota&lt;/aside>&lt;/li>
                &lt;li class='keycap tex' data-insert='{\\char"39F}'>&amp;#x039F;&lt;aside>omicron&lt;/aside>&lt;/li>
                &lt;li class='keycap tex' data-insert='\\Pi '>&amp;Pi;&lt;aside>pi&lt;/aside>&lt;/li>&lt;/ul>
            &lt;ul>&lt;li class='keycap tex' data-insert='{\\char"391}'>&amp;#x391;&lt;aside>alpha&lt;/aside>&lt;/li>
                &lt;li class='keycap tex' data-insert='\\Sigma '>&amp;Sigma;&lt;aside>sigma&lt;/aside>&lt;/li>
                &lt;li class='keycap tex' data-insert='\\Delta '>&amp;Delta;&lt;aside>delta&lt;/aside>&lt;/li>
                &lt;li class='keycap tex' data-insert='\\Phi '>&amp;#x03a6;&lt;aside>phi&lt;/aside>&lt;/li>
                &lt;li class='keycap tex' data-insert='\\Gamma '>&amp;Gamma;&lt;aside>gamma&lt;/aside>&lt;/li>
                &lt;li class='keycap tex' data-insert='{\\char"397}'>&amp;Eta;&lt;aside>eta&lt;/aside>&lt;/li>
                &lt;li class='keycap tex' data-insert='\\Xi '>&amp;Xi;&lt;aside>xi&lt;/aside>&lt;/li>
                &lt;li class='keycap tex' data-insert='{\\char"39A}'>&amp;Kappa;&lt;aside>kappa&lt;/aside>&lt;/li>
                &lt;li class='keycap tex' data-insert='\\Lambda '>&amp;Lambda;&lt;aside>lambda&lt;/aside>&lt;/li>&lt;/ul>
            &lt;ul>&lt;li class='shift modifier font-glyph bottom left selected w15 layer-switch' data-layer='lower-greek'>&amp;#x21e7;&lt;/li>
                &lt;li class='keycap tex' data-insert='{\\char"396}'>&amp;Zeta;&lt;aside>zeta&lt;/aside>&lt;/li>
                &lt;li class='keycap tex' data-insert='{\\char"3A7}'>&amp;Chi;&lt;aside>chi&lt;/aside>&lt;/li>
                &lt;li class='keycap tex' data-insert='\\Psi '>&amp;Psi;&lt;aside>psi&lt;/aside>&lt;/li>
                &lt;li class='keycap tex' data-insert='\\Omega '>&amp;Omega;&lt;aside>omega&lt;/aside>&lt;/li>
                &lt;li class='keycap tex' data-insert='{\\char"392}'>&amp;Beta;&lt;aside>beta&lt;/aside>&lt;/li>
                &lt;li class='keycap tex' data-insert='{\\char"39D}'>&amp;Nu;&lt;aside>nu&lt;/aside>&lt;/li>
                &lt;li class='keycap tex' data-insert='{\\char"39C}'>&amp;Mu;&lt;aside>mu&lt;/aside>&lt;/li>
                &lt;li class='action font-glyph bottom right w15' data-command='["performWithFeedback","deletePreviousChar"]'>&amp;#x232b;&lt;/li>&lt;/ul>
            &lt;ul>
                &lt;li class='separator w10'>&amp;nbsp;&lt;/li>
                &lt;li class='keycap'>.&lt;/li>
                &lt;li class='keycap w50' data-key=' '>&amp;nbsp;&lt;/li>
                &lt;arrows/>
            &lt;/ul>
        &lt;/div>`,
    'lower-command': `
        &lt;div class='rows'>
            &lt;ul>&lt;row name='lower-1' class='tt' shift-layer='upper-command'/>&lt;/ul>
            &lt;ul>&lt;row name='lower-2' class='tt' shift-layer='upper-command'/>&lt;/ul>
            &lt;ul>&lt;row name='lower-3' class='tt' shift-layer='upper-command'/>&lt;/ul>
            &lt;ul>
                &lt;li class='layer-switch font-glyph modifier bottom left' data-layer='symbols-command'>01#&lt;/li>
                &lt;li class='keycap tt' data-shifted='[' data-shifted-command='["insertAndUnshiftKeyboardLayer", "["]'>{&lt;/li>
                &lt;li class='keycap tt' data-shifted=']' data-shifted-command='["insertAndUnshiftKeyboardLayer", "]"]'>}&lt;/li>
                &lt;li class='keycap tt' data-shifted='(' data-shifted-command='["insertAndUnshiftKeyboardLayer", "("]'>^&lt;/li>
                &lt;li class='keycap tt' data-shifted=')' data-shifted-command='["insertAndUnshiftKeyboardLayer", ")"]'>_&lt;/li>
                &lt;li class='keycap w20' data-key=' '>&amp;nbsp;&lt;/li>
                &lt;arrows/>
            &lt;/ul>
        &lt;/div>`,
    'upper-command': `
        &lt;div class='rows'>
            &lt;ul>&lt;row name='upper-1' class='tt' shift-layer='lower-command'/>&lt;/ul>
            &lt;ul>&lt;row name='upper-2' class='tt' shift-layer='lower-command'/>&lt;/ul>
            &lt;ul>&lt;row name='upper-3' class='tt' shift-layer='lower-command'/>&lt;/ul>
            &lt;ul>
                &lt;li class='layer-switch font-glyph modifier bottom left' data-layer='symbols-command'01#&lt;/li>
                &lt;li class='keycap tt'>[&lt;/li>
                &lt;li class='keycap tt'>]&lt;/li>
                &lt;li class='keycap tt'>(&lt;/li>
                &lt;li class='keycap tt'>)&lt;/li>
                &lt;li class='keycap w20' data-key=' '>&amp;nbsp;&lt;/li>
                &lt;arrows/>
            &lt;/ul>
        &lt;/div>`,
    'symbols-command': `
        &lt;div class='rows'>
            &lt;ul>&lt;li class='keycap tt'>1&lt;/li>&lt;li class='keycap tt'>2&lt;/li>&lt;li class='keycap tt'>3&lt;/li>&lt;li class='keycap tt'>4&lt;/li>&lt;li class='keycap tt'>5&lt;/li>&lt;li class='keycap tt'>6&lt;/li>&lt;li class='keycap tt'>7&lt;/li>&lt;li class='keycap tt'>8&lt;/li>&lt;li class='keycap tt'>9&lt;/li>&lt;li class='keycap tt'>0&lt;/li>&lt;/ul>
            &lt;ul>&lt;li class='keycap tt'>!&lt;/li>&lt;li class='keycap tt'>@&lt;/li>&lt;li class='keycap tt'>#&lt;/li>&lt;li class='keycap tt'>$&lt;/li>&lt;li class='keycap tt'>%&lt;/li>&lt;li class='keycap tt'>^&lt;/li>&lt;li class='keycap tt'>&amp;&lt;/li>&lt;li class='keycap tt'>*&lt;/li>&lt;li class='keycap tt'>+&lt;/li>&lt;li class='keycap tt'>=&lt;/li>&lt;/ul>
            &lt;ul>
                &lt;li class='keycap tt'>\\&lt;/li>
                &lt;li class='keycap tt'>|&lt;/li>
                &lt;li class='keycap tt'>/&lt;/li>
                &lt;li class='keycap tt'>\`&lt;/li>
                &lt;li class='keycap tt'>;&lt;/li>
                &lt;li class='keycap tt'>:&lt;/li>
                &lt;li class='keycap tt'>?&lt;/li>
                &lt;li class='keycap tt'>'&lt;/li>
                &lt;li class='keycap tt'>"&lt;/li>
                &lt;li class='action font-glyph bottom right'
                    data-shifted='&lt;span class="warning">&lt;svg>&lt;use xlink:href="#svg-trash" />&lt;/svg>&lt;/span>'
                    data-shifted-command='"deleteAll"'
                    data-alt-keys='delete' data-command='["performWithFeedback","deletePreviousChar"]'
                >&amp;#x232b;&lt;/li>
            &lt;/ul>
            &lt;ul>
                &lt;li class='layer-switch font-glyph modifier bottom left' data-layer='lower-command'>abc&lt;/li>
                &lt;li class='keycap tt'>&amp;lt;&lt;/li>
                &lt;li class='keycap tt'>&amp;gt;&lt;/li>
                &lt;li class='keycap tt'>~&lt;/li>
                &lt;li class='keycap tt'>,&lt;/li>
                &lt;li class='keycap tt'>.&lt;/li>
                &lt;li class='keycap' data-key=' '>&amp;nbsp;&lt;/li>
                &lt;arrows/>
            &lt;/ul>
        &lt;/div>`,
    'functions': `
        &lt;div class='rows'>
            &lt;ul>&lt;li class='separator'>&lt;/li>
                &lt;li class='fnbutton' data-insert='\\sin'>&lt;/li>
                &lt;li class='fnbutton' data-insert='\\sin^{-1}'>&lt;/li>
                &lt;li class='fnbutton' data-insert='\\ln'>&lt;/li>
                &lt;li class='fnbutton' data-insert='\\exponentialE^{#?}'>&lt;/li>
                &lt;li class='bigfnbutton' data-insert='\\mathop{lcm}(#?)' data-latex='\\mathop{lcm}()'>&lt;/li>
                &lt;li class='bigfnbutton' data-insert='\\mathop{ceil}(#?)' data-latex='\\mathop{ceil}()'>&lt;/li>
                &lt;li class='bigfnbutton' data-insert='\\lim_{n\\to\\infty}'>&lt;/li>
                &lt;li class='bigfnbutton' data-insert='\\int'>&lt;/li>
                &lt;li class='bigfnbutton' data-insert='\\mathop{abs}(#?)' data-latex='\\mathop{abs}()'>&lt;/li>
            &lt;/ul>
            &lt;ul>&lt;li class='separator'>&lt;/li>
                &lt;li class='fnbutton' data-insert='\\cos'>&lt;/li>
                &lt;li class='fnbutton' data-insert='\\cos^{-1}'>&lt;/li>
                &lt;li class='fnbutton' data-insert='\\ln_{10}'>&lt;/li>
                &lt;li class='fnbutton' data-insert='10^{#?}'>&lt;/li>
                &lt;li class='bigfnbutton' data-insert='\\mathop{gcd}(#?)' data-latex='\\mathop{gcd}()'>&lt;/li>
                &lt;li class='bigfnbutton' data-insert='\\mathop{floor}(#?)' data-latex='\\mathop{floor}()'>&lt;/li>
                &lt;li class='bigfnbutton' data-insert='\\sum_{n\\mathop=0}^{\\infty}'>&lt;/li>
                &lt;li class='bigfnbutton' data-insert='\\int_{0}^{\\infty}'>&lt;/li>
                &lt;li class='bigfnbutton' data-insert='\\mathop{sign}(#?)' data-latex='\\mathop{sign}()'>&lt;/li>
            &lt;/ul>
            &lt;ul>&lt;li class='separator'>&lt;/li>
                &lt;li class='fnbutton' data-insert='\\tan'>&lt;/li>
                &lt;li class='fnbutton' data-insert='\\tan^{-1}'>&lt;/li>
                &lt;li class='fnbutton' data-insert='\\log_{#?}'>&lt;/li>
                &lt;li class='fnbutton' data-insert='\\sqrt[#?]{#0}'>&lt;/li>
                &lt;li class='bigfnbutton' data-insert='#0 \\mod' data-latex='\\mod'>&lt;/li>
                &lt;li class='bigfnbutton' data-insert='\\mathop{round}(#?) ' data-latex='\\mathop{round}()'>&lt;/li>
                &lt;li class='bigfnbutton' data-insert='\\prod_{n\\mathop=0}^{\\infty}' data-latex='{\\tiny \\prod_{n=0}^{\\infty}}'>&lt;/li>
                &lt;li class='bigfnbutton' data-insert='\\frac{\\differentialD #0}{\\differentialD x}'>&lt;/li>
                &lt;li class='action font-glyph bottom right' data-command='["performWithFeedback","deletePreviousChar"]'>&amp;#x232b;&lt;/li>&lt;/ul>
            &lt;ul>&lt;li class='separator'>&lt;/li>
                &lt;li class='fnbutton'>(&lt;/li>
                &lt;li class='fnbutton'>)&lt;/li>
                &lt;li class='fnbutton' data-insert='^{#?} ' data-latex='x^{#?} '>&lt;/li>
                &lt;li class='fnbutton' data-insert='_{#?} ' data-latex='x_{#?} '>&lt;/li>
                &lt;li class='keycap w20 ' data-key=' '>&amp;nbsp;&lt;/li>
                &lt;arrows/>
            &lt;/ul>
        &lt;/div>`,
}

function latexToMarkup(latex, arg, mf) {
    // Since we don't have preceding atoms, we'll interpret #@ as a placeholder
    latex = latex.replace(/(^|[^\\])#@/g, '$1#?');

    const parse = ParserModule.parseTokens(Lexer.tokenize(latex), 'math',
        arg, mf.config.macros);
    const spans = MathAtom.decompose({
            mathstyle: 'displaystyle',
            macros: mf.config.macros
        }, parse);

    const base = Span.makeSpan(spans, 'ML__base');

    const topStrut = Span.makeSpan('', 'ML__strut');
    topStrut.setStyle('height', base.height, 'em');
    const bottomStrut = Span.makeSpan('', 'ML__strut--bottom');
    bottomStrut.setStyle('height', base.height + base.depth, 'em');
    bottomStrut.setStyle('vertical-align', -base.depth, 'em');
    const wrapper = Span.makeSpan([topStrut, bottomStrut, base], 'ML__mathlive');

    return wrapper.toMarkup();
}


/**
 * Return a markup string for the keyboard toolbar for the specified layer.
 */
function makeKeyboardToolbar(mf, keyboardIDs, currentKeyboard) {
    // The left hand side of the toolbar has a list of all the available keyboards
    let result = "&lt;div class='left'>";
    const keyboardList = keyboardIDs.replace(/\s+/g, ' ').split(' ');
    if (keyboardList.length > 1) {
        const keyboards = Object.assign({}, KEYBOARDS, mf.config.customVirtualKeyboards || {});

        for (const keyboard of keyboardList) {
            if (!keyboards[keyboard]) {
                console.error('Unknown virtual keyboard "' + keyboard + '"');
                break;
            }
            result += '&lt;div class=\'';
            if (keyboard === currentKeyboard) {
                result += 'selected ';
            } else {
                if (keyboards[keyboard].command) {
                    result += 'action ';
                } else {
                    result += 'layer-switch ';
                }
            }

            result += (keyboards[keyboard].classes || '') + "'";

            if (keyboards[keyboard].tooltip) {
                result += "data-tooltip='" + keyboards[keyboard].tooltip + "' ";
                result += "data-placement='top' data-delay='1s'";
            }

            if (keyboard !== currentKeyboard) {
                if (keyboards[keyboard].command) {
                    result += "data-command='\"" + keyboards[keyboard].command + "\"'";
                }

                if (keyboards[keyboard].layer) {
                    result += "data-layer='" + keyboards[keyboard].layer + "'";
                }

            }
            result += '>' + keyboards[keyboard].label + '&lt;/div>';
        }
    }
    result += '&lt;/div>';

    // The right hand side of the toolbar, with the copy/undo/redo commands
    result += `
        &lt;div class='right'>
            &lt;div class='action'
                data-command='"copyToClipboard"'
                data-tooltip='Copy to Clipboard' data-placement='top' data-delay='1s'>
                &lt;svg>&lt;use xlink:href='#svg-copy' />&lt;/svg>
            &lt;/div>
            &lt;div class='action disabled'
                data-command='"undo"'
                data-tooltip='Undo' data-placement='top' data-delay='1s'>
                &lt;svg>&lt;use xlink:href='#svg-undo' />&lt;/svg>
            &lt;/div>
            &lt;div class='action disabled'
                data-command='"redo"'
                data-tooltip='Redo' data-placement='top' data-delay='1s'>
                &lt;svg>&lt;use xlink:href='#svg-redo' />&lt;/svg>
            &lt;/div>
        &lt;/div>
    `;

    return "&lt;div class='keyboard-toolbar' role='toolbar'>" + result + "&lt;/div>";
}


function makeKeycap(mf, elList, chainedCommand) {
    for (let i = 0; i &lt; elList.length; ++i) {
        const el = elList[i];
        // Display
        if (el.getAttribute('data-latex')) {
            el.innerHTML = latexToMarkup(el.getAttribute('data-latex').replace(/&amp;quot;/g, '"'),
                    {'?':'{\\color{#555}{\\tiny \\char"2B1A}}'}, mf);
        } else if (el.innerHTML === '' &amp;&amp; el.getAttribute('data-insert')) {
            el.innerHTML = latexToMarkup(el.getAttribute('data-insert').replace(/&amp;quot;/g, '"'),
                    {'?':'{\\color{#555}{\\tiny \\char"2B1A}}'}, mf);
        } else if (el.getAttribute('data-content')) {
            el.innerHTML = el.getAttribute('data-content').replace(/&amp;quot;/g, '"');
        }
        if (el.getAttribute('data-aside')) {
            el.innerHTML += '&lt;aside>' + el.getAttribute('data-aside').replace(/&amp;quot;/g, '"') + '&lt;/aside>';
        }
        if (el.getAttribute('data-classes')) {
            el.classList.add(el.getAttribute('data-classes'));
        }

        let key = el.getAttribute('data-insert');
        if (key) key = key.replace(/&amp;quot;/g, '"');
        if (key &amp;&amp; SHIFTED_KEYS[key]) {
            el.setAttribute('data-shifted', SHIFTED_KEYS[key].label);
            el.setAttribute('data-shifted-command',
                JSON.stringify(['insertAndUnshiftKeyboardLayer', SHIFTED_KEYS[key].insert]));
        }

        // Commands
        let handlers;
        if (el.getAttribute('data-command')) {
            handlers = JSON.parse(el.getAttribute('data-command'));
        } else if (el.getAttribute('data-insert')) {
            handlers = ['insert', el.getAttribute('data-insert'),
                {focus:true, feedback:true}];
        } else if (el.getAttribute('data-latex')) {
            handlers = ['insert', el.getAttribute('data-latex'),
                {focus:true, feedback:true}];
        } else {
            handlers = ['typedText', el.getAttribute('data-key') || el.textContent,
                {focus:true, feedback:true}];
        }
        if (chainedCommand) {
            handlers = [chainedCommand, handlers];
        }
        if (el.getAttribute('data-alt-keys')) {
            const altKeys = ALT_KEYS[el.getAttribute('data-alt-keys')];
            if (altKeys) {
                handlers = {
                    default: handlers,
                    pressAndHoldStart: ['showAlternateKeys', el.getAttribute('data-alt-keys'), altKeys],
                    pressAndHoldEnd: 'hideAlternateKeys'
                }
            } else {
                console.log('Unknown alt key set: "' + el.getAttribute('data-alt-keys'));
            }
        }

        mf._attachButtonHandlers(el, handlers);

    }
}

/**
 * Expand the shortcut tags (e.g. &lt;row>) inside a layer.
 * @param {*} mf
 * @param {*} layer
 */
function expandLayerMarkup(mf, layer) {
    const ROWS = {
        // First row should be 10 key wide
        // Second row should be 10 key wide
        // Third row should be 8.5 key wide
        // One row should have ^ (shift key) which is 1.5 key wide
        // One row should have ~ (delete key) which is .5 or 1.5 key wide
        'qwerty': {
                'lower-1': 'qwertyuiop',
                'lower-2': ' asdfghjkl ',
                'lower-3': '^zxcvbnm~',
                'upper-1': 'QWERTYUIOP',
                'upper-2': ' ASDFGHJKL ',
                'upper-3': '^ZXCVBNM~',
                'numpad-1': '789/',
                'numpad-2': '456*',
                'numpad-3': '123-',
                'numpad-4': '0.=+',
        },
        'azerty': {
                'lower-1': 'azertyuiop',
                'lower-2': 'qsdfghjklm',
                'lower-3': '^ wxcvbn ~',
                'upper-1': 'AZERTYUIOP',
                'upper-2': 'QSDFGHJKLM',
                'upper-3': '^ WXCVBN ~'
        },
        'qwertz': {
                'lower-1': 'qwertzuiop',
                'lower-2': ' asdfghjkl ',
                'lower-3': '^yxcvbnm~',
                'upper-1': 'QWERTZUIOP',
                'upper-2': ' ASDFGHJKL',
                'upper-3': '^YXCVBNM~'
        },
        'dvorak': {
                'lower-1': '^  pyfgcrl ',
                'lower-2': 'aoeuidhtns',
                'lower-3': 'qjkxbmwvz~',
                'upper-1': '^  PYFGCRL ',
                'upper-2': 'AOEUIDHTNS',
                'upper-3': 'QJKXBMWVZ~'
        },
        'colemak': {
                'lower-1': ' qwfpgjluy ',
                'lower-2': 'arstdhneio',
                'lower-3': '^zxcvbkm~',
                'upper-1': ' QWFPGNLUY ',
                'upper-2': 'ARSTDHNEIO',
                'upper-3': '^ZXCVBKM~'
        },


    }
    const layout = ROWS[mf.config.virtualKeyboardLayout] ?
        ROWS[mf.config.virtualKeyboardLayout] : ROWS['qwerty'];

    let result = layer;
    let row;

    result = result.replace(/&lt;arrows\/>/g, `
        &lt;li class='action' data-command='["performWithFeedback","moveToPreviousChar"]'
            data-shifted='&lt;svg>&lt;use xlink:href="#svg-angle-double-left" />&lt;/svg>'
            data-shifted-command='["performWithFeedback","extendToPreviousChar"]'>
            &lt;svg>&lt;use xlink:href='#svg-arrow-left' />&lt;/svg>
        &lt;/li>
        &lt;li class='action' data-command='["performWithFeedback","moveToNextChar"]'
            data-shifted='&lt;svg>&lt;use xlink:href="#svg-angle-double-right" />&lt;/svg>'
            data-shifted-command='["performWithFeedback","extendToNextChar"]'>
            &lt;svg>&lt;use xlink:href='#svg-arrow-right' />&lt;/svg>
        &lt;/li>
        &lt;li class='action' data-command='["performWithFeedback","moveToNextPlaceholder"]'>
        &lt;svg>&lt;use xlink:href='#svg-tab' />&lt;/svg>&lt;/li>`);


    let m = result.match(/(&lt;row\s+)(.*)((?:&lt;\/row|\/)>)/);
    while (m) {
        row = '';
        const attributesArray = m[2].match(/[a-zA-Z][a-zA-Z0-9-]*=(['"])(.*?)\1/g);
        const attributes = {};
        for (const attribute of attributesArray) {
            const m2 = attribute.match(/([a-zA-Z][a-zA-Z0-9-]*)=(['"])(.*?)\2/);
            attributes[m2[1]] = m2[3];
        }


        let keys = layout[attributes['name']];
        if (!keys) keys = ROWS['qwerty'][attributes['name']];
        if (!keys) {
            console.log('Unknown roman keyboard row: ' + attributes['name']);
        } else {
            for (const c of keys) {
                let cls = attributes['class'] || '';
                if (cls) cls = ' ' + cls;
                if (c === '~') {
                    row += `&lt;li class='action font-glyph bottom right `;
                    row += keys.length -
                        ((keys.match(/ /g) || []).length / 2) === 10 ? 'w10' : 'w15';
                    row += `' data-shifted='&lt;span class="warning">&lt;svg>&lt;use xlink:href="#svg-trash" />&lt;/svg>&lt;/span>'
                        data-shifted-command='"deleteAll"'
                        data-alt-keys='delete' data-command='["performWithFeedback","deletePreviousChar"]'
                        >&amp;#x232b;&lt;/li>`;

                } else if (c === ' ') {
                    // Separator
                    row += "&lt;li class='separator w5'>&lt;/li>";
                } else if (c === '^') {
                    // Shift key
                    row += `&lt;li class='shift modifier font-glyph bottom left w15 layer-switch' data-layer='` +
                        attributes['shift-layer'] + `'>&amp;#x21e7;&lt;/li>`;
                } else if (c === '/') {
                    row += "&lt;li class='keycap" + cls + "' data-alt-keys='/' data-insert='\\frac{#0}{#?}'>&amp;divide;&lt;/li>";
                } else if (c === '*') {
                    row += "&lt;li class='keycap" + cls + "' data-alt-keys='*' data-insert='\\times '>&amp;times;&lt;/li>";
                } else if (c === '-') {
                    row += "&lt;li class='keycap" + cls + "' data-alt-keys='*' data-key='-' data-alt-keys='-'>&amp;#x2212;&lt;/li>";
                } else if (/tt/.test(cls)) {
                    row += "&lt;li class='keycap" + cls + "' data-alt-keys='" + c + "'" +
                    ` data-command='["typedText","` + c + `",{"commandMode":true, "focus":true, "feedback":true}]'` +
                    ">" + c + "&lt;/li>"
                } else {
                    row += "&lt;li class='keycap" + cls + "' data-alt-keys='" + c + "'>" + c + "&lt;/li>"
                }
            }

        }
        result = result.replace(new RegExp(m[1] + m[2] + m[3]), row);

        m = result.match(/(&lt;row\s+)(.*)((?:&lt;\/row|\/)>)/);
    }


    return result;
}

/**
 * Construct a virtual keyboard element based on the config options in the
 * mathfield and an optional theme.
 * @param {Object} mf
 * @param {string} theme
 * @result {} A DOM element
 */
function make(mf, theme) {
    const svgIcons =
        `&lt;svg xmlns="http://www.w3.org/2000/svg" style="display: none;">

            &lt;symbol id="svg-command" viewBox="0 0 640 512">
                &lt;path d="M34.495 36.465l211.051 211.05c4.686 4.686 4.686 12.284 0 16.971L34.495 475.535c-4.686 4.686-12.284 4.686-16.97 0l-7.071-7.07c-4.686-4.686-4.686-12.284 0-16.971L205.947 256 10.454 60.506c-4.686-4.686-4.686-12.284 0-16.971l7.071-7.07c4.686-4.687 12.284-4.687 16.97 0zM640 468v-10c0-6.627-5.373-12-12-12H300c-6.627 0-12 5.373-12 12v10c0 6.627 5.373 12 12 12h328c6.627 0 12-5.373 12-12z"/>
            &lt;/symbol>

            &lt;symbol id="svg-undo" viewBox="0 0 512 512">
                &lt;path d="M20 8h10c6.627 0 12 5.373 12 12v110.625C85.196 57.047 165.239 7.715 256.793 8.001 393.18 8.428 504.213 120.009 504 256.396 503.786 393.181 392.834 504 256 504c-63.926 0-122.202-24.187-166.178-63.908-5.113-4.618-5.354-12.561-.482-17.433l7.069-7.069c4.503-4.503 11.749-4.714 16.482-.454C150.782 449.238 200.935 470 256 470c117.744 0 214-95.331 214-214 0-117.744-95.331-214-214-214-82.862 0-154.737 47.077-190.289 116H180c6.627 0 12 5.373 12 12v10c0 6.627-5.373 12-12 12H20c-6.627 0-12-5.373-12-12V20c0-6.627 5.373-12 12-12z"/>
            &lt;/symbol>
            &lt;symbol id="svg-redo" viewBox="0 0 512 512">
                &lt;path d="M492 8h-10c-6.627 0-12 5.373-12 12v110.625C426.804 57.047 346.761 7.715 255.207 8.001 118.82 8.428 7.787 120.009 8 256.396 8.214 393.181 119.166 504 256 504c63.926 0 122.202-24.187 166.178-63.908 5.113-4.618 5.354-12.561.482-17.433l-7.069-7.069c-4.503-4.503-11.749-4.714-16.482-.454C361.218 449.238 311.065 470 256 470c-117.744 0-214-95.331-214-214 0-117.744 95.331-214 214-214 82.862 0 154.737 47.077 190.289 116H332c-6.627 0-12 5.373-12 12v10c0 6.627 5.373 12 12 12h160c6.627 0 12-5.373 12-12V20c0-6.627-5.373-12-12-12z"/>
            &lt;/symbol>
            &lt;symbol id="svg-arrow-left" viewBox="0 0 192 512">
                &lt;path d="M25.1 247.5l117.8-116c4.7-4.7 12.3-4.7 17 0l7.1 7.1c4.7 4.7 4.7 12.3 0 17L64.7 256l102.2 100.4c4.7 4.7 4.7 12.3 0 17l-7.1 7.1c-4.7 4.7-12.3 4.7-17 0L25 264.5c-4.6-4.7-4.6-12.3.1-17z"/>
            &lt;/symbol>
            &lt;symbol id="svg-arrow-right" viewBox="0 0 192 512">
                    &lt;path d="M166.9 264.5l-117.8 116c-4.7 4.7-12.3 4.7-17 0l-7.1-7.1c-4.7-4.7-4.7-12.3 0-17L127.3 256 25.1 155.6c-4.7-4.7-4.7-12.3 0-17l7.1-7.1c4.7-4.7 12.3-4.7 17 0l117.8 116c4.6 4.7 4.6 12.3-.1 17z"/>
            &lt;/symbol>
            &lt;symbol id="svg-tab" viewBox="0 0 448 512">
                    &lt;path d="M32 217.1c0-8.8 7.2-16 16-16h144v-93.9c0-7.1 8.6-10.7 13.6-5.7l143.5 143.1c6.3 6.3 6.3 16.4 0 22.7L205.6 410.4c-5 5-13.6 1.5-13.6-5.7v-93.9H48c-8.8 0-16-7.2-16-16v-77.7m-32 0v77.7c0 26.5 21.5 48 48 48h112v61.9c0 35.5 43 53.5 68.2 28.3l143.6-143c18.8-18.8 18.8-49.2 0-68L228.2 78.9c-25.1-25.1-68.2-7.3-68.2 28.3v61.9H48c-26.5 0-48 21.6-48 48zM436 64h-8c-6.6 0-12 5.4-12 12v360c0 6.6 5.4 12 12 12h8c6.6 0 12-5.4 12-12V76c0-6.6-5.4-12-12-12z"/>
            &lt;/symbol>
            &lt;symbol id="svg-copy" viewBox="0 0 448 512">
                &lt;path d="M433.941 65.941l-51.882-51.882A48 48 0 0 0 348.118 0H176c-26.51 0-48 21.49-48 48v48H48c-26.51 0-48 21.49-48 48v320c0 26.51 21.49 48 48 48h224c26.51 0 48-21.49 48-48v-48h80c26.51 0 48-21.49 48-48V99.882a48 48 0 0 0-14.059-33.941zM352 32.491a15.88 15.88 0 0 1 7.431 4.195l51.882 51.883A15.885 15.885 0 0 1 415.508 96H352V32.491zM288 464c0 8.822-7.178 16-16 16H48c-8.822 0-16-7.178-16-16V144c0-8.822 7.178-16 16-16h80v240c0 26.51 21.49 48 48 48h112v48zm128-96c0 8.822-7.178 16-16 16H176c-8.822 0-16-7.178-16-16V48c0-8.822 7.178-16 16-16h144v72c0 13.2 10.8 24 24 24h72v240z"/>
            &lt;/symbol>
            &lt;symbol id="svg-angle-double-right" viewBox="0 0 320 512">
                &lt;path d="M166.9 264.5l-117.8 116c-4.7 4.7-12.3 4.7-17 0l-7.1-7.1c-4.7-4.7-4.7-12.3 0-17L127.3 256 25.1 155.6c-4.7-4.7-4.7-12.3 0-17l7.1-7.1c4.7-4.7 12.3-4.7 17 0l117.8 116c4.6 4.7 4.6 12.3-.1 17zm128-17l-117.8-116c-4.7-4.7-12.3-4.7-17 0l-7.1 7.1c-4.7 4.7-4.7 12.3 0 17L255.3 256 153.1 356.4c-4.7 4.7-4.7 12.3 0 17l7.1 7.1c4.7 4.7 12.3 4.7 17 0l117.8-116c4.6-4.7 4.6-12.3-.1-17z"/>
            &lt;/symbol>
            &lt;symbol id="svg-angle-double-left" viewBox="0 0 320 512">
                &lt;path d="M153.1 247.5l117.8-116c4.7-4.7 12.3-4.7 17 0l7.1 7.1c4.7 4.7 4.7 12.3 0 17L192.7 256l102.2 100.4c4.7 4.7 4.7 12.3 0 17l-7.1 7.1c-4.7 4.7-12.3 4.7-17 0L153 264.5c-4.6-4.7-4.6-12.3.1-17zm-128 17l117.8 116c4.7 4.7 12.3 4.7 17 0l7.1-7.1c4.7-4.7 4.7-12.3 0-17L64.7 256l102.2-100.4c4.7-4.7 4.7-12.3 0-17l-7.1-7.1c-4.7-4.7-12.3-4.7-17 0L25 247.5c-4.6 4.7-4.6 12.3.1 17z"/>
            &lt;/symbol>
            &lt;symbol id="svg-trash" viewBox="0 0 448 512">
                &lt;path d="M336 64l-33.6-44.8C293.3 7.1 279.1 0 264 0h-80c-15.1 0-29.3 7.1-38.4 19.2L112 64H24C10.7 64 0 74.7 0 88v2c0 3.3 2.7 6 6 6h26v368c0 26.5 21.5 48 48 48h288c26.5 0 48-21.5 48-48V96h26c3.3 0 6-2.7 6-6v-2c0-13.3-10.7-24-24-24h-88zM184 32h80c5 0 9.8 2.4 12.8 6.4L296 64H152l19.2-25.6c3-4 7.8-6.4 12.8-6.4zm200 432c0 8.8-7.2 16-16 16H80c-8.8 0-16-7.2-16-16V96h320v368zm-176-44V156c0-6.6 5.4-12 12-12h8c6.6 0 12 5.4 12 12v264c0 6.6-5.4 12-12 12h-8c-6.6 0-12-5.4-12-12zm-80 0V156c0-6.6 5.4-12 12-12h8c6.6 0 12 5.4 12 12v264c0 6.6-5.4 12-12 12h-8c-6.6 0-12-5.4-12-12zm160 0V156c0-6.6 5.4-12 12-12h8c6.6 0 12 5.4 12 12v264c0 6.6-5.4 12-12 12h-8c-6.6 0-12-5.4-12-12z"/>
            &lt;/symbol>
        &lt;/svg>
        `;
            // &lt;symbol id="svg-wikipedia" viewBox="0 0 640 512">
            //         &lt;path d="M640 51.2l-.3 12.2c-28.1.8-45 15.8-55.8 40.3-25 57.8-103.3 240-155.3 358.6H415l-81.9-193.1c-32.5 63.6-68.3 130-99.2 193.1-.3.3-15 0-15-.3C172 352.3 122.8 243.4 75.8 133.4 64.4 106.7 26.4 63.4.2 63.7c0-3.1-.3-10-.3-14.2h161.9v13.9c-19.2 1.1-52.8 13.3-43.3 34.2 21.9 49.7 103.6 240.3 125.6 288.6 15-29.7 57.8-109.2 75.3-142.8-13.9-28.3-58.6-133.9-72.8-160-9.7-17.8-36.1-19.4-55.8-19.7V49.8l142.5.3v13.1c-19.4.6-38.1 7.8-29.4 26.1 18.9 40 30.6 68.1 48.1 104.7 5.6-10.8 34.7-69.4 48.1-100.8 8.9-20.6-3.9-28.6-38.6-29.4.3-3.6 0-10.3.3-13.6 44.4-.3 111.1-.3 123.1-.6v13.6c-22.5.8-45.8 12.8-58.1 31.7l-59.2 122.8c6.4 16.1 63.3 142.8 69.2 156.7L559.2 91.8c-8.6-23.1-36.4-28.1-47.2-28.3V49.6l127.8 1.1.2.5z"/>
            // &lt;/symbol>
            // &lt;symbol id="svg-link" viewBox="0 0 512 512">
            //         &lt;path d="M301.148 394.702l-79.2 79.19c-50.778 50.799-133.037 50.824-183.84 0-50.799-50.778-50.824-133.037 0-183.84l79.19-79.2a132.833 132.833 0 0 1 3.532-3.403c7.55-7.005 19.795-2.004 20.208 8.286.193 4.807.598 9.607 1.216 14.384.481 3.717-.746 7.447-3.397 10.096-16.48 16.469-75.142 75.128-75.3 75.286-36.738 36.759-36.731 96.188 0 132.94 36.759 36.738 96.188 36.731 132.94 0l79.2-79.2.36-.36c36.301-36.672 36.14-96.07-.37-132.58-8.214-8.214-17.577-14.58-27.585-19.109-4.566-2.066-7.426-6.667-7.134-11.67a62.197 62.197 0 0 1 2.826-15.259c2.103-6.601 9.531-9.961 15.919-7.28 15.073 6.324 29.187 15.62 41.435 27.868 50.688 50.689 50.679 133.17 0 183.851zm-90.296-93.554c12.248 12.248 26.362 21.544 41.435 27.868 6.388 2.68 13.816-.68 15.919-7.28a62.197 62.197 0 0 0 2.826-15.259c.292-5.003-2.569-9.604-7.134-11.67-10.008-4.528-19.371-10.894-27.585-19.109-36.51-36.51-36.671-95.908-.37-132.58l.36-.36 79.2-79.2c36.752-36.731 96.181-36.738 132.94 0 36.731 36.752 36.738 96.181 0 132.94-.157.157-58.819 58.817-75.3 75.286-2.651 2.65-3.878 6.379-3.397 10.096a163.156 163.156 0 0 1 1.216 14.384c.413 10.291 12.659 15.291 20.208 8.286a131.324 131.324 0 0 0 3.532-3.403l79.19-79.2c50.824-50.803 50.799-133.062 0-183.84-50.802-50.824-133.062-50.799-183.84 0l-79.2 79.19c-50.679 50.682-50.688 133.163 0 183.851z"/>
            // &lt;/symbol>
            //     &lt;symbol id="svg-external-link" viewBox="0 0 448 512">
            //     &lt;path d="M400 32H48C21.49 32 0 53.49 0 80v352c0 26.51 21.49 48 48 48h352c26.51 0 48-21.49 48-48V80c0-26.51-21.49-48-48-48zm16 400c0 8.822-7.178 16-16 16H48c-8.822 0-16-7.178-16-16V80c0-8.822 7.178-16 16-16h352c8.822 0 16 7.178 16 16v352zM99.515 374.828c-4.686-4.686-4.686-12.284 0-16.971l195.15-195.15-.707-.707-89.958.342c-6.627 0-12-5.373-12-12v-9.999c0-6.628 5.372-12 12-12L340 128c6.627 0 12 5.372 12 12l-.343 136c0 6.627-5.373 12-12 12h-9.999c-6.627 0-12-5.373-12-12l.342-89.958-.707-.707-195.15 195.15c-4.686 4.686-12.284 4.686-16.971 0l-5.657-5.657z"/>
            // &lt;/symbol>
            // &lt;symbol id="svg-external-link" viewBox="0 0 512 512">
            //     &lt;path d="M256 40c118.621 0 216 96.075 216 216 0 119.291-96.61 216-216 216-119.244 0-216-96.562-216-216 0-119.203 96.602-216 216-216m0-32C119.043 8 8 119.083 8 256c0 136.997 111.043 248 248 248s248-111.003 248-248C504 119.083 392.957 8 256 8zm-36 344h12V232h-12c-6.627 0-12-5.373-12-12v-8c0-6.627 5.373-12 12-12h48c6.627 0 12 5.373 12 12v140h12c6.627 0 12 5.373 12 12v8c0 6.627-5.373 12-12 12h-72c-6.627 0-12-5.373-12-12v-8c0-6.627 5.373-12 12-12zm36-240c-17.673 0-32 14.327-32 32s14.327 32 32 32 32-14.327 32-32-14.327-32-32-32z"/>
            // &lt;/symbol>

    let markup = svgIcons;

    // Add an element to hold the alternate keys displayed on press+hold
    markup += '&lt;div class="alternate-keys">&lt;/div>';

    // Auto-populate the ALT_KEYS table
    ALT_KEYS_BASE['foreground-color'] = [];
    for (const color of Color.LINE_COLORS) {
        ALT_KEYS_BASE['foreground-color'].push({
            classes: 'small-button',
            content: '&lt;span style="border-radius:50%;width:32px;height:32px; background:' + color + '">&lt;/span>',
            command:'["applyStyle",{"color":"' + color + '"}]'
        });
    }
    ALT_KEYS_BASE['background-color'] = [];
    for (const color of Color.AREA_COLORS) {
        ALT_KEYS_BASE['background-color'].push({
            classes: 'small-button',
            content: '&lt;span style="border-radius:50%;width:32px;height:32px; background:' + color + '">&lt;/span>',
            command:'["applyStyle",{"backgroundColor":"' + color + '"}]'
        });
    }

    ALT_KEYS = {};
    ALT_KEYS = Object.assign({}, ALT_KEYS_BASE);
    for (const key in ALT_KEYS) {
        if (ALT_KEYS.hasOwnProperty(key)) {
            ALT_KEYS[key] = ALT_KEYS[key].slice();
        }
    }



    const upperAlpha = 'ABCDEFGHIJKLMNOPQRSTUVWXYZ';
    const lowerAlpha = 'abcdefghijklmnopqrstuvwxyz';
    const digits = '0123456789';
    for (let i = 0; i &lt; 26; i++) {
        const key = upperAlpha[i];
        if (!ALT_KEYS[key]) ALT_KEYS[key] = [];
        ALT_KEYS[key].unshift({
                latex: '\\mathbb{' + key + '}',
                aside: 'blackboard',
                insert: '\\mathbb{' + key + '}'});
        ALT_KEYS[key].unshift({
                latex: '\\mathbf{' + key + '}',
                aside: 'bold',
                insert: '\\mathbf{' + key + '}'});
        ALT_KEYS[key].unshift({
                latex: '\\mathsf{' + key + '}',
                aside: 'sans',
                insert: '\\mathsf{' + key + '}'});
        ALT_KEYS[key].unshift({
                latex: '\\mathtt{' + key + '}',
                aside: 'monospace',
                insert: '\\mathtt{' + key + '}'});
        ALT_KEYS[key].unshift({
                latex: '\\mathcal{' + key + '}',
                aside: 'script',
                insert: '\\mathcal{' + key + '}'});
        ALT_KEYS[key].unshift({
                latex: '\\mathfrak{' + key + '}',
                aside: 'fraktur',
                insert: '\\mathfrak{' + key + '}'});

        ALT_KEYS[key].unshift({
                latex: '\\mathbb{' + lowerAlpha[i] + '}',
                aside: 'blackboard',
                insert: '\\mathbb{' + lowerAlpha[i] + '}'});
        ALT_KEYS[key].unshift({
                latex: '\\mathbf{' + lowerAlpha[i] + '}',
                aside: 'bold',
                insert: '\\mathbf{' + lowerAlpha[i] + '}'});
        ALT_KEYS[key].unshift({
                latex: '\\mathsf{' + lowerAlpha[i] + '}',
                aside: 'sans',
                insert: '\\mathsf{' + lowerAlpha[i] + '}'});
        ALT_KEYS[key].unshift({
                latex: '\\mathcal{' + lowerAlpha[i] + '}',
                aside: 'script',
                insert: '\\mathcal{' + lowerAlpha[i] + '}'});
        ALT_KEYS[key].unshift({
                latex: '\\mathfrak{' + lowerAlpha[i] + '}',
                aside: 'fraktur',
                insert: '\\mathfrak{' + lowerAlpha[i] + '}'});
    }
    for (let i = 0; i &lt;= 26; i++) {
        const key = lowerAlpha[i];
        if (!ALT_KEYS[key]) ALT_KEYS[key] = [];
        ALT_KEYS[key].unshift({
                latex: '\\mathsf{' + key + '}',
                aside: 'sans',
                insert: '\\mathbb{' + key + '}'});
        ALT_KEYS[key].unshift({
                latex: '\\mathbf{' + key + '}',
                aside: 'bold',
                insert: '\\mathbf{' + key + '}'});
        ALT_KEYS[key].unshift({
                latex: '\\mathtt{' + key + '}',
                aside: 'monospace',
                insert: '\\mathtt{' + key + '}'});
        ALT_KEYS[key].unshift({
                latex: '\\mathfrak{' + key + '}',
                aside: 'fraktur',
                insert: '\\mathfrak{' + key + '}'});
    }
    for (let i = 0; i &lt; 10; i++) {
        const key = digits[i];
        if (!ALT_KEYS[key]) ALT_KEYS[key] = [];
        // The mathbb font does not appear to include digits,
        // although it's supposed to.
        // ALT_KEYS[key].push({
        //         latex: '\\underset{\\textsf{\\footnotesize blackboard}}{\\mathbb{' + key + '}}',
        //         insert: '\\mathbb{' + key + '}}'});
        ALT_KEYS[key].unshift({
                latex: '\\mathbf{' + key + '}',
                aside: 'bold',
                insert: '\\mathbf{' + key + '}'});
        ALT_KEYS[key].unshift({
                latex: '\\mathsf{' + key + '}',
                aside: 'sans',
                insert: '\\mathsf{' + key + '}'});
        ALT_KEYS[key].unshift({
                latex: '\\mathtt{' + key + '}',
                aside: 'monospace',
                insert: '\\mathtt{' + key + '}'});
        ALT_KEYS[key].unshift({
                latex: '\\mathcal{' + key + '}',
                aside: 'script',
                insert: '\\mathcal{' + key + '}'});
        ALT_KEYS[key].unshift({
                latex: '\\mathfrak{' + key + '}',
                aside: 'fraktur',
                insert: '\\mathfrak{' + key + '}'});
    }




    let keyboardIDs = mf.config.virtualKeyboards;
    if (!keyboardIDs) {
        keyboardIDs = 'all';
    }
    keyboardIDs = keyboardIDs.replace(/\ball\b/i, 'numeric roman greek functions command')

    const layers = Object.assign({}, LAYERS, mf.config.customVirtualKeyboardLayers || {});


    const keyboards = Object.assign({}, KEYBOARDS, mf.config.customVirtualKeyboards || {});

    const keyboardList = keyboardIDs.replace(/\s+/g, ' ').split(' ');
    for (const keyboard of keyboardList) {
        if (!keyboards[keyboard]) {
            console.error('Unknown virtual keyboard "' + keyboard + '"');
            break;
        }
        // Add the default layer to the list of layers,
        // and make sure the list of layers is uniquified.
        let keyboardLayers = keyboards[keyboard].layers || [];
        if (keyboards[keyboard].layer) {
            keyboardLayers.push(keyboards[keyboard].layer);
        }
        keyboardLayers = Array.from(new Set(keyboardLayers));

        for (const layer of keyboardLayers) {
            if (!layers[layer]) {
                console.error('Unknown virtual keyboard layer: "' + layer + '"');
                break;
            }
            markup += `&lt;div class='keyboard-layer' id='` + layer + `'>`;
            markup += makeKeyboardToolbar(mf, keyboardIDs, keyboard);
            const layerMarkup = typeof layers[layer] === 'function' ?
                layers[layer]() : layers[layer];
            // A layer can contain 'shortcuts' (i.e. &lt;row> tags) that need to
            // be expanded
            markup += expandLayerMarkup(mf, layerMarkup);
            markup += '&lt;/div>';
        }
    }

    const result = document.createElement('div');
    result.id = 'ML__keyboard';
    if (theme) {
        result.classList.add(theme);
    } else if (mf.config.virtualKeyboardTheme) {
        result.classList.add(mf.config.virtualKeyboardTheme);
    } else if (/android|cros/i.test(navigator.userAgent)) {
        result.classList.add('material');
    }
    result.innerHTML = markup;

    // Attach the element handlers
    makeKeycap(mf, result.querySelectorAll('.keycap, .action, .fnbutton, .bigfnbutton'));

    const elList = result.getElementsByClassName('layer-switch');
    for (let i = 0; i &lt; elList.length; ++i) {
        if (elList[i].classList.contains('shift')) {
            // This is a potential press-and-hold layer switch
            mf._attachButtonHandlers(elList[i], {
                // When the modifier is initially pressed, we will shift the labels
                // (if available)
                pressed: ['shiftKeyboardLayer', 'shift'],

                // If the key is released before a delay, we switch to the target layer
                default: ['switchKeyboardLayer', elList[i].getAttribute('data-layer')],

                // If the key is released after a longer delay, we restore the
                // shifted labels
                pressAndHoldEnd: 'unshiftKeyboardLayer',
            });
        } else {
            // This is a simple layer switch
            mf._attachButtonHandlers(elList[i], {
                default: ['switchKeyboardLayer', elList[i].getAttribute('data-layer')]
            });
        }
    }

    // Select the first keyboard as the initial one.
    result.getElementsByClassName('keyboard-layer')[0].classList.add('visible');

    // Listen to know when the mouse has been released without being
    // captured to remove the alternate keys panel and the shifted state of the
    // keyboard.
    window.addEventListener('mouseup', function() {
        mf.hideAlternateKeys_();
        mf.unshiftKeyboardLayer_();
    });
    window.addEventListener('blur', function() {
        mf.hideAlternateKeys_();
        mf.unshiftKeyboardLayer_();
    });
    window.addEventListener('touchend', function() {
        mf.hideAlternateKeys_();
        mf.unshiftKeyboardLayer_();
    });
    window.addEventListener('touchcancel', function() {
        mf.hideAlternateKeys_();
        mf.unshiftKeyboardLayer_();
    });

    return result;
}




export default {
    make,
    makeKeycap
}


</code></pre>
        </article>
    </section>




</main>


<script src="https://ajax.googleapis.com/ajax/libs/jquery/3.2.1/jquery.min.js"></script>
<script src="scripts/namis.search.jquery.js"></script>
<script>
    function readCookie(a) {
        var b = document.cookie.match('(^|;)\\s*' + a + '\\s*=\\s*([^;]+)');
        return b ? b.pop() : '';
    }
    function writeCookie(a, v) {
		var date = new Date();
		date.setTime(date.getTime()+(30*24*60*60*1000));
    	document.cookie = a + "=" + v + "; expires=" + date.toUTCString() + "; path=/";
    }

    var cookie = readCookie('symbol-access');
    if (cookie === 'no-private') {
        document.documentElement.classList.add('no-private');
    }
    
   document.getElementById('toggle-private').checked = 
    !document.documentElement.classList.contains('no-private');


    prettyPrint();
    (function($){
        $('#nav').search(['className', 'methodName']);
    })(jQuery);
</script>
<script src="scripts/linenumber.js"></script>


    <script src="http://mathlive.io/deploy/mathlive/mathlive.js"></script><script>if (MathLive) {MathLive.renderMathInDocument();}</script>


</body>
</html>
